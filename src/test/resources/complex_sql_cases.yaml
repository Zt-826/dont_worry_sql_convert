- comment: 未结付查询脚本
  oracle_sql: >
    Select
      x.payNo                                       ,
      x.Accreinscode Paycode                        ,
      x.Freinsname                                  ,
      x.Freinscode                                  ,
      x.treatyename                                 ,
      x.Accno                                       ,
      x.acckind                                     ,
      x.Riskcode                                    ,
      x.Riskname                                    ,
      x.Repolicyno                                  ,
      x.Recertifyno                                 ,
      x.Drcertifyno                                 ,
      To_Char(x.Settledate, 'yyyy-mm-dd') Settledate,
      x.Treatyno                                    ,
      x.Sectionno                                   ,
      x.uwyear                                      ,
      x.Accperiod                                   ,
      x.Buscurrency                                 ,
      x.balance1                                    ,
      x.Acccurrency                                 ,
      x.balance                                     ,
      x.Serialbalance                               ,
      x.Freinsbalance                               ,
      x.reinsurerBalance                            ,
      x.Busandaccexchrate                           ,
      x.Codeename                                   ,
      x.Acckinds                                    ,
      x.Taxflag                                     ,
      x.Withholdflag                                ,
      x.Codecname                                   ,
      x.Writtendate                                 ,
      x.Yourref                                     ,
      x.Youraccno                                   ,
      x.writeFlag                                   ,
      x.writeOffFlag                                ,
      x.settleApplyNo                               ,
      x.settleApplyStatus
    from
      (
        Select
          m.Freinsname       ,
          m.Freinscode       ,
          m.treatyename      ,
          m.Accno            ,
          m.Riskcode         ,
          m.Riskname         ,
          m.acckind          ,
          m.Repolicyno       ,
          m.Recertifyno      ,
          m.Drcertifyno      ,
          m.Settledate       ,
          m.Treatyno         ,
          m.Sectionno        ,
          m.uwyear           ,
          m.Accperiod        ,
          m.Buscurrency      ,
          m.balance1         ,
          m.Acccurrency      ,
          m.balance          ,
          m.Serialbalance    ,
          m.Freinsbalance    ,
          m.reinsurerBalance ,
          m.Busandaccexchrate,
          m.Codeename        ,
          m.Acckinds         ,
          m.Taxflag          ,
          m.Withholdflag     ,
          m.Accreinscode     ,
          m.Codecname        ,
          m.Writtendate      ,
          m.Yourref          ,
          m.Youraccno        ,
          m.payno            ,
          m.Settlestatus     ,
          m.Letter           ,
          m.writeFlag        ,
          m.writeOffFlag     ,
          Row_Number() Over
                            (
                              partition by m.Letter
                              Order By m.Accperiod,
                                m.Treatyno        ,
                                m.Accno           ,
                                m.Sectionno       ,
                                m.Freinscode      ,
                                m.Codecname       ,
                                m.treatyename     ,
                                m.Buscurrency     ,
                                m.balance1
                            )
          As Serialno     ,
          '' settleApplyNo,
          '' settleApplyStatus
        from
          (
            Select
              h.Freinsname ,
              h.Freinscode ,
              h.treatyename,
              h.Accno      ,
              h.Riskcode   ,
              h.Riskname   ,
              h.acckind    ,
              h.Repolicyno ,
              h.Recertifyno,
              h.Drcertifyno,
              h.Settledate ,
              h.Treatyno   ,
              h.Sectionno  ,
              h.uwyear     ,
              h.Accperiod  ,
              h.Buscurrency,
              sum(h.Busbalance) over
                                     (
                                       partition by h.accno
                                     )
              balance1     ,
              h.Acccurrency,
              sum(h.Accbalance) over
                                     (
                                       partition by h.accno
                                     )
              balance,
              sum(h.Accbalance) over
                                     (
                                       partition by h.accno,
                                         h.payno
                                     )
              Serialbalance               ,
              h.Freinsbalance             ,
              h.reinsurerBalance          ,
              h.busandaccexchrate         ,
              h.acckinds                  ,
              h.taxflag                   ,
              h.withholdflag              ,
              h.Accreinscode              ,
              h.writtendate               ,
              h.yourref                   ,
              h.youraccno                 ,
              Decode(h.Facflag            ,
                  '1'                     ,'特约-' || e.Codeename,
                    e.Codeename) Codeename,
              e.Codecname                 ,
              h.Settlestatus              ,
              h.payno                     ,
              h.Letter                    ,
              h.writeFlag                 ,
              h.writeOffFlag
            from
              (
                Select
                  b.longName Freinsname                                     ,
                  a.Freinscode                                              ,
                  c.OPTTYPE                                                 ,
                  d.treatyename                                             ,
                  c.Accno                                                   ,
                  '' As Riskcode                                            ,
                  '' As Riskname                                            ,
                  '合约' acckind                                              ,
                  '' As Repolicyno                                          ,
                  '' As Recertifyno                                         ,
                  '' As Drcertifyno                                         ,
                  a.Settledate                                              ,
                  c.Treatyno                                                ,
                  c.Sectionno                                               ,
                  c.uwyear                                                  ,
                  c.Accperiod                                               ,
                  c.writeFlag                                               ,
                  sum(a.Busbalance) Busbalance                              ,
                  sum(a.Accbalance) Accbalance                              ,
                  (Sum(a.Accbalance) - Sum(a.Accpaidvalue)) Freinsbalance   ,
                  (Sum(a.Busbalance) - Sum(a.busPaidValue)) reinsurerBalance,
                  a.Buscurrency                                             ,
                  a.Acccurrency                                             ,
                  a.busandaccexchrate                                       ,
                  c.acckind acckinds                                        ,
                  c.taxflag                                                 ,
                  c.withholdflag                                            ,
                  c.Accreinscode                                            ,
                  c.writtendate                                             ,
                  c.yourref                                                 ,
                  c.youraccno                                               ,
                  a.Settlestatus                                            ,
                  decode(substr(d.Treatytype, 0, 1)                         ,
                      '7'                                                   ,a.payno,
                        1) payno                                            ,
                  c.Acctype                                                 ,
                  c.Facflag                                                 ,
                  decode(substr(d.Treatytype, 0, 1)                         ,
                      '7'                                                   ,'B',
                        'A') As Letter                                      ,
                  decode(c.writeOffFlag                                     ,
                      '0'                                                   , '',
                        '1'                                                 , '冲销账') as writeOffFlag
                From
                  Fzplanmain a,
                  Fzacc c     ,
                  (
                    select
                      treatyno   ,
                      treatyename,
                      Treatytype ,
                      accperiod
                    from
                      Fhtreaty) d,
                  fdReins b
                Where
                  a.Accno        = c.Accno
                And c.Treatyno   = d.Treatyno
                and a.Freinscode = b.REINSCODE(+)
                And c.Opttype    = ''
                And (
                    case
                      substr(d.Treatytype, 0, 1)
                    when
                      '7'
                    then
                      decode(c.Acckind,
                          'O'         , 0,
                            'L'       , 0,
                              1)
                    else
                      decode(d.Accperiod    ,
                          'P'               ,decode(c.Acckind,
                              'P'           ,0,
                                'E'         ,0,
                                  'C'       ,0,1),
                            decode(c.Acckind,
                                'I'         , 0,
                                  1))
                    end)           = 1
                And c.Confirmstate = '1'
                And c.Accreinscode In ('')
                And c.Acccurrency  In ('')
                And c.Acctype = '11'
                Group By
                  c.OPTTYPE                        ,
                  b.longName                       ,
                  a.Freinscode                     ,
                  d.treatyename                    ,
                  c.Accno                          ,
                  a.Settledate                     ,
                  c.Treatyno                       ,
                  c.Sectionno                      ,
                  c.uwyear                         ,
                  c.Accperiod                      ,
                  a.Buscurrency                    ,
                  a.Acccurrency                    ,
                  a.busandaccexchrate              ,
                  c.acckind                        ,
                  c.taxflag                        ,
                  c.withholdflag                   ,
                  c.Accreinscode                   ,
                  c.writtendate                    ,
                  c.yourref                        ,
                  c.youraccno                      ,
                  d.Treatytype                     ,
                  a.Settlestatus                   ,
                  decode(substr(d.Treatytype, 0, 1),
                      '7'                          ,a.payno,
                        1)                         ,
                  c.Acctype                        ,
                  c.Facflag                        ,
                  c.writeOffFlag                   ,
                  c.writeFlag) h
            Left Join
              Fdcode e
            On
              h.Acckinds      = e.Codetype
            And h.Acctype     = e.Codecode
            and h.opttype     = e.codedesc
            And e.Newcodecode = 'fdsettleConfig') m
        where
          1 = 1
        and m.Settlestatus in ('0',
                              '1')
        And to_date(to_char(m.SettleDate, 'yyyy-mm-dd'), 'yyyy-mm-dd') <= to_date(to_char('', 'yyyy-mm-dd'), 'yyyy-mm-dd')

        union all

        Select
          m.Freinsname       ,
          m.Freinscode       ,
          m.treatyename      ,
          m.Accno            ,
          m.Riskcode         ,
          m.Riskname         ,
          m.acckind          ,
          m.Repolicyno       ,
          m.Recertifyno      ,
          m.Drcertifyno      ,
          m.Settledate       ,
          m.Treatyno         ,
          m.Sectionno        ,
          m.uwyear           ,
          m.Accperiod        ,
          m.Buscurrency      ,
          m.balance1         ,
          m.Acccurrency      ,
          m.balance          ,
          m.Serialbalance    ,
          m.Freinsbalance    ,
          m.reinsurerBalance ,
          m.Busandaccexchrate,
          m.Codeename        ,
          m.Acckinds         ,
          m.Taxflag          ,
          m.Withholdflag     ,
          m.Accreinscode     ,
          m.Codecname        ,
          m.Writtendate      ,
          m.Yourref          ,
          m.Youraccno        ,
          m.payno            ,
          m.Settlestatus     ,
          m.Letter           ,
          m.writeFlag        ,
          m.writeOffFlag     ,
          Row_Number() Over
                            (
                              partition by m.Letter
                              Order By m.Codecname,
                                m.Accperiod       ,
                                m.Treatyno        ,
                                m.Sectionno       ,
                                m.Freinscode      ,
                                m.treatyename     ,
                                m.Buscurrency     ,
                                m.balance1
                            )
          As Serialno     ,
          '' settleApplyNo,
          '' settleApplyStatus
        from
          (
            Select
              h.Freinsname ,
              h.Freinscode ,
              h.treatyename,
              h.Accno      ,
              h.Riskcode   ,
              h.Riskname   ,
              h.acckind    ,
              h.Repolicyno ,
              h.Recertifyno,
              h.Drcertifyno,
              h.Settledate ,
              h.Treatyno   ,
              h.Sectionno  ,
              h.uwyear     ,
              h.Accperiod  ,
              h.Buscurrency,
              sum(h.Busbalance) over
                                     (
                                       partition by h.accno
                                     )
              balance1     ,
              h.Acccurrency,
              sum(h.Accbalance) over
                                     (
                                       partition by h.accno
                                     )
              balance,
              sum(h.Accbalance) over
                                     (
                                       partition by h.accno,
                                         h.payno
                                     )
              Serialbalance               ,
              h.Freinsbalance             ,
              h.reinsurerBalance          ,
              h.busandaccexchrate         ,
              h.acckinds                  ,
              h.taxflag                   ,
              h.withholdflag              ,
              h.Accreinscode              ,
              h.writtendate               ,
              h.yourref                   ,
              h.youraccno                 ,
              h.writeFlag                 ,
              Decode(h.Facflag            ,
                  '1'                     , '特约-' || e.Codeename,
                    e.Codeename) Codeename,
              Decode(e.Codetype           ,
                  'X'                     , '0',
                    e.Codecname) Codecname,
              h.Settlestatus              ,
              h.payno                     ,
              h.Letter                    ,
              h.writeOffFlag
            from
              (
                Select
                  b.longName Freinsname                                     ,
                  a.Freinscode                                              ,
                  c.OPTTYPE                                                 ,
                  d.treatyename                                             ,
                  c.Accno                                                   ,
                  '' As Riskcode                                            ,
                  '' As Riskname                                            ,
                  '合约' acckind                                              ,
                  '' As Repolicyno                                          ,
                  '' As Recertifyno                                         ,
                  '' As Drcertifyno                                         ,
                  a.Settledate                                              ,
                  c.Treatyno                                                ,
                  to_char(c.layerNo) as Sectionno                           ,
                  c.uwyear                                                  ,
                  decode(c.accKind                                          ,
                      'X'                                                   , to_char(a.payno),
                        c.accPeriod) Accperiod                              ,
                  c.writeFlag                                               ,
                  sum(a.Busbalance) Busbalance                              ,
                  sum(a.Accbalance) Accbalance                              ,
                  (Sum(a.Accbalance) - Sum(a.Accpaidvalue)) Freinsbalance   ,
                  (Sum(a.Busbalance) - Sum(a.busPaidValue)) reinsurerBalance,
                  a.Buscurrency                                             ,
                  a.Acccurrency                                             ,
                  a.busandaccexchrate                                       ,
                  c.acckind acckinds                                        ,
                  c.taxflag                                                 ,
                  c.withholdflag                                            ,
                  c.Accreinscode                                            ,
                  c.writtendate                                             ,
                  c.yourref                                                 ,
                  c.youraccno                                               ,
                  a.Settlestatus                                            ,
                  decode(substr(d.Treatytype, 0, 1)                         ,
                      '7'                                                   , a.payno,
                        1) payno                                            ,
                  c.Acctype                                                 ,
                  c.Facflag                                                 ,
                  decode(substr(d.Treatytype, 0, 1)                         ,
                      '7'                                                   , 'B',
                        'A') As Letter                                      ,
                  decode(c.writeOffFlag                                     ,
                      '0'                                                   , '',
                        '1'                                                 , '冲销账') as writeOffFlag
                From
                  Fzplanmain a,
                  Fzacc c     ,
                  (
                    select
                      treatyno   ,
                      treatyename,
                      Treatytype ,
                      ''
                    from
                      Fhxtreaty) d,
                  fdReins b
                Where
                  a.Accno        = c.Accno
                And c.Treatyno   = d.Treatyno
                and a.Freinscode = b.REINSCODE(+)
                And c.Opttype    = ''
                And (
                    case
                      substr(d.Treatytype, 0, 1)
                    when
                      '7'
                    then
                      decode(c.Acckind,
                          'O'         , 0,
                            'L'       , 0,
                              1)
                    end)           = 1
                And c.Confirmstate = '1'
                And c.Accreinscode In ('')
                And c.Acccurrency  In ('')
                And c.Acctype = '11'
                Group By
                  c.OPTTYPE                        ,
                  b.longName                       ,
                  a.Freinscode                     ,
                  d.treatyename                    ,
                  c.Accno                          ,
                  a.Settledate                     ,
                  c.Treatyno                       ,
                  c.layerNo                        ,
                  c.uwyear                         ,
                  decode(c.accKind                 ,
                      'X'                          , to_char(a.payno),
                        c.accPeriod)               ,
                  a.Buscurrency                    ,
                  a.Acccurrency                    ,
                  a.busandaccexchrate              ,
                  c.acckind                        ,
                  c.taxflag                        ,
                  c.withholdflag                   ,
                  c.Accreinscode                   ,
                  c.writtendate                    ,
                  c.yourref                        ,
                  c.youraccno                      ,
                  d.Treatytype                     ,
                  a.Settlestatus                   ,
                  decode(substr(d.Treatytype, 0, 1),
                      '7'                          , a.payno,
                        1)                         ,
                  c.Acctype                        ,
                  c.Facflag                        ,
                  c.writeOffFlag                   ,
                  c.writeFlag) h
            Left Join
              Fdcode e
            On
              h.Acckinds      = e.Codetype
            And h.Acctype     = e.Codecode
            and h.opttype     = e.codedesc
            And e.Newcodecode = 'fdsettleConfig') m
        where
          1 = 1
        and m.Settlestatus in ('0',
                              '1')
        And to_date(to_char(m.SettleDate, 'yyyy-mm-dd'), 'yyyy-mm-dd') <= to_date(to_char('', 'yyyy-mm-dd'), 'yyyy-mm-dd')

        union all

        Select
          m.Freinsname                                                                                                                                 ,
          m.Freinscode                                                                                                                                 ,
          m.Insuredname treatyename                                                                                                                    ,
          m.Accno                                                                                                                                      ,
          m.Riskcode                                                                                                                                   ,
          m.Riskname                                                                                                                                   ,
          m.acckind                                                                                                                                    ,
          m.Repolicyno                                                                                                                                 ,
          m.Recertifyno                                                                                                                                ,
          m.Drcertifyno                                                                                                                                ,
          m.Settledate                                                                                                                                 ,
          m.Treatyno                                                                                                                                   ,
          m.Sectionno                                                                                                                                  ,
          m.uwyear                                                                                                                                     ,
          m.Accperiod                                                                                                                                  ,
          m.Buscurrency                                                                                                                                ,
          m.balance1                                                                                                                                   ,
          m.Acccurrency                                                                                                                                ,
          m.balance                                                                                                                                    ,
          m.Serialbalance                                                                                                                              ,
          m.Freinsbalance                                                                                                                              ,
          m.reinsurerBalance                                                                                                                           ,
          m.Busandaccexchrate                                                                                                                          ,
          m.Codeename                                                                                                                                  ,
          m.Acckinds                                                                                                                                   ,
          m.Taxflag                                                                                                                                    ,
          m.Withholdflag                                                                                                                               ,
          m.Accreinscode                                                                                                                               ,
          m.Codecname                                                                                                                                  ,
          m.Writtendate                                                                                                                                ,
          m.Yourref                                                                                                                                    ,
          m.Youraccno                                                                                                                                  ,
          m.payno                                                                                                                                      ,
          m.Settlestatus                                                                                                                               ,
          m.Letter                                                                                                                                     ,
          m.writeFlag                                                                                                                                  ,
          m.writeOffFlag                                                                                                                               ,
          Row_Number() Over(Order By m.Codecname, m.uwyear, m.Drcertifyno, m.payno, m.Freinscode, m.Insuredname, m.Buscurrency, m.balance1) As Serialno,
          m.settleApplyNo                                                                                                                              ,
          m.settleApplyStatus
        from
          (
            Select
              h.Freinsname         ,
              h.Freinscode         ,
              h.Insuredname        ,
              h.Accno              ,
              h.Riskcode           ,
              h.Riskname           ,
              h.acckind            ,
              h.Repolicyno         ,
              h.Recertifyno        ,
              h.Drcertifyno        ,
              h.Settledate         ,
              h.Treatyno           ,
              h.Sectionno          ,
              h.uwyear             ,
              h.Accperiod          ,
              h.Buscurrency        ,
              h.Busbalance balance1,
              h.Acccurrency        ,
              h.Accbalance balance ,
              (
                select
                  sum(ACCBALANCE)
                from
                  FZPLANMAIN x
                where
                  x.ACCNO   = h.ACCNO
                and x.PAYNO = h.PAYNO) Serialbalance,
              h.Freinsbalance                       ,
              h.reinsurerBalance                    ,
              h.busandaccexchrate                   ,
              h.acckinds                            ,
              h.taxflag                             ,
              h.withholdflag                        ,
              h.Accreinscode                        ,
              h.writtendate                         ,
              h.yourref                             ,
              h.youraccno                           ,
              h.writeFlag                           ,
              Decode(h.Facflag                      ,
                  '1'                               , '特约-' || e.Codeename,
                    e.Codeename) Codeename          ,
              e.Codecname                           ,
              h.Settlestatus                        ,
              h.payno                               ,
              h.Letter                              ,
              h.writeOffFlag                        ,
              h.settleApplyNo                       ,
              h.settleApplyStatus
            from
              (
                Select
                  b.longName Freinsname                                     ,
                  a.Freinscode                                              ,
                  c.OPTTYPE                                                 ,
                  c.Insuredname                                             ,
                  c.Accno                                                   ,
                  c.Riskcode                                                ,
                  d.Riskcname Riskname                                      ,
                  '临分' || '-' || decode(c.Acckind                           ,
                      'P'                                                   , '保单',
                        'H'                                                 , '保单',
                          'E'                                               , '批单',
                            'J'                                             , '批单',
                              'C'                                           , '赔案',
                                'K'                                         , '赔案',
                                  '') acckind                               ,
                  c.Repolicyno                                              ,
                  c.Recertifyno                                             ,
                  c.Drcertifyno                                             ,
                  a.Settledate                                              ,
                  '' As Treatyno                                            ,
                  '' As Sectionno                                           ,
                  c.uwyear                                                  ,
                  c.writeFlag                                               ,
                  a.payno || '' Accperiod                                   ,
                  c.Busbalance                                              ,
                  c.Accbalance                                              ,
                  (Sum(a.Accbalance) - Sum(a.Accpaidvalue)) Freinsbalance   ,
                  (Sum(a.Busbalance) - Sum(a.busPaidValue)) reinsurerBalance,
                  a.Buscurrency                                             ,
                  a.Acccurrency                                             ,
                  a.busandaccexchrate                                       ,
                  c.acckind acckinds                                        ,
                  c.taxflag                                                 ,
                  c.withholdflag                                            ,
                  c.Accreinscode                                            ,
                  c.writtendate                                             ,
                  c.yourref                                                 ,
                  c.youraccno                                               ,
                  a.Settlestatus                                            ,
                  a.payno                                                   ,
                  c.Acctype                                                 ,
                  c.Facflag                                                 ,
                  'C' As Letter                                             ,
                  decode(c.writeOffFlag                                     ,
                      '0'                                                   , '',
                        '1'                                                 , '冲销账') as writeOffFlag,
                  a.settleApplyNo                                           ,
                  a.settleApplyStatus
                From
                  Fzplanmain a,
                  Fzacc c     ,
                  fdrisk d    ,
                  fdReins b
                Where
                  a.Accno          = c.Accno
                And c.riskcode     = d.riskcode
                and a.Freinscode   = b.REINSCODE(+)
                And c.Opttype      = ''
                And c.Confirmstate = '1'
                And c.Accreinscode In ('')
                And c.Acccurrency  In ('')
                And c.Acctype = '10'
                Group By
                  c.OPTTYPE          ,
                  b.longName         ,
                  a.Freinscode       ,
                  c.Insuredname      ,
                  c.Accno            ,
                  c.Riskcode         ,
                  d.Riskcname        ,
                  c.Repolicyno       ,
                  c.Recertifyno      ,
                  c.Drcertifyno      ,
                  a.Settledate       ,
                  c.Treatyno         ,
                  c.Sectionno        ,
                  c.uwyear           ,
                  a.Buscurrency      ,
                  a.Acccurrency      ,
                  a.busandaccexchrate,
                  c.acckind          ,
                  c.taxflag          ,
                  c.withholdflag     ,
                  c.Accreinscode     ,
                  c.writtendate      ,
                  c.yourref          ,
                  c.youraccno        ,
                  a.Settlestatus     ,
                  a.payno            ,
                  c.Acctype          ,
                  c.Facflag          ,
                  c.writeOffFlag     ,
                  c.writeFlag        ,
                  a.settleApplyNo    ,
                  a.settleApplyStatus,
                  a.Accbalance       ,
                  a.Busbalance       ,
                  a.Accpaidvalue     ,
                  a.busPaidValue     ,
                  c.Accbalance       ,
                  c.Busbalance) h
            Left Join
              Fdcode e
            On
              h.Acckinds      = e.Codetype
            And h.Acctype     = e.Codecode
            and h.opttype     = e.codedesc
            And e.Newcodecode = 'fdsettleConfig') m
        where
          1 = 1
        and m.Settlestatus in ('0',
                              '1')
        And to_date(to_char(m.SettleDate, 'yyyy-mm-dd'), 'yyyy-mm-dd') <= to_date(to_char('', 'yyyy-mm-dd'), 'yyyy-mm-dd')) x
    where
      (
        x.Freinsbalance       <> 0
        or x.reinsurerBalance <> 0)
    order by
      Decode(x.Acccurrency  ,
          'CNY'             , '1',
            'USD'           , '2',
              x.Acccurrency),
      x.Letter              ,
      x.Serialno
  tidb_sql: >
    SELECT x.payNo, x.Accreinscode AS Paycode, x.Freinsname, x.Freinscode, x.treatyename
    	, x.Accno, x.acckind, x.Riskcode, x.Riskname, x.Repolicyno
    	, x.Recertifyno, x.Drcertifyno, DATE_FORMAT(x.Settledate, '%Y-%m-%d') AS Settledate
    	, x.Treatyno, x.Sectionno, x.uwyear, x.Accperiod, x.Buscurrency
    	, x.balance1, x.Acccurrency, x.balance, x.Serialbalance, x.Freinsbalance
    	, x.reinsurerBalance, x.Busandaccexchrate, x.Codeename, x.Acckinds, x.Taxflag
    	, x.Withholdflag, x.Codecname, x.Writtendate, x.Yourref, x.Youraccno
    	, x.writeFlag, x.writeOffFlag, x.settleApplyNo, x.settleApplyStatus
    FROM (
    	SELECT m.Freinsname, m.Freinscode, m.treatyename, m.Accno, m.Riskcode
    		, m.Riskname, m.acckind, m.Repolicyno, m.Recertifyno, m.Drcertifyno
    		, m.Settledate, m.Treatyno, m.Sectionno, m.uwyear, m.Accperiod
    		, m.Buscurrency, m.balance1, m.Acccurrency, m.balance, m.Serialbalance
    		, m.Freinsbalance, m.reinsurerBalance, m.Busandaccexchrate, m.Codeename, m.Acckinds
    		, m.Taxflag, m.Withholdflag, m.Accreinscode, m.Codecname, m.Writtendate
    		, m.Yourref, m.Youraccno, m.payno, m.Settlestatus, m.Letter
    		, m.writeFlag, m.writeOffFlag, Row_Number() OVER (PARTITION BY m.Letter ORDER BY m.Accperiod, m.Treatyno, m.Accno, m.Sectionno, m.Freinscode, m.Codecname, m.treatyename, m.Buscurrency, m.balance1) AS Serialno, NULL AS settleApplyNo
    		, NULL AS settleApplyStatus
    	FROM (
    		SELECT h.Freinsname, h.Freinscode, h.treatyename, h.Accno, h.Riskcode
    			, h.Riskname, h.acckind, h.Repolicyno, h.Recertifyno, h.Drcertifyno
    			, h.Settledate, h.Treatyno, h.Sectionno, h.uwyear, h.Accperiod
    			, h.Buscurrency, sum(h.Busbalance) OVER (PARTITION BY h.accno) AS balance1, h.Acccurrency
    			, sum(h.Accbalance) OVER (PARTITION BY h.accno) AS balance
    			, sum(h.Accbalance) OVER (PARTITION BY h.accno, h.payno) AS Serialbalance, h.Freinsbalance
    			, h.reinsurerBalance, h.busandaccexchrate, h.acckinds, h.taxflag, h.withholdflag
    			, h.Accreinscode, h.writtendate, h.yourref, h.youraccno
    			, CASE h.Facflag
    				WHEN '1' THEN CONCAT('特约-', e.Codeename)
    				ELSE e.Codeename
    			END AS Codeename
    			, e.Codecname, h.Settlestatus, h.payno, h.Letter, h.writeFlag
    			, h.writeOffFlag
    		FROM (
    			SELECT b.longName AS Freinsname, a.Freinscode, c.OPTTYPE, d.treatyename, c.Accno
    				, NULL AS Riskcode, NULL AS Riskname, '合约' AS acckind, NULL AS Repolicyno, NULL AS Recertifyno
    				, NULL AS Drcertifyno, a.Settledate, c.Treatyno, c.Sectionno, c.uwyear
    				, c.Accperiod, c.writeFlag, sum(a.Busbalance) AS Busbalance
    				, sum(a.Accbalance) AS Accbalance
    				, Sum(a.Accbalance) - Sum(a.Accpaidvalue) AS Freinsbalance
    				, Sum(a.Busbalance) - Sum(a.busPaidValue) AS reinsurerBalance
    				, a.Buscurrency, a.Acccurrency, a.busandaccexchrate, c.acckind AS acckinds, c.taxflag
    				, c.withholdflag, c.Accreinscode, c.writtendate, c.yourref, c.youraccno
    				, a.Settlestatus
    				, CASE SUBSTRING(d.Treatytype, 0, 1)
    					WHEN '7' THEN a.payno
    					ELSE 1
    				END AS payno
    				, c.Acctype, c.Facflag
    				, CASE SUBSTRING(d.Treatytype, 0, 1)
    					WHEN '7' THEN 'B'
    					ELSE 'A'
    				END AS Letter
    				, CASE c.writeOffFlag
    					WHEN '0' THEN NULL
    					WHEN '1' THEN '冲销账'
    					ELSE '冲销账'
    				END AS writeOffFlag
    			FROM Fzacc c
    			JOIN (
    				SELECT treatyno, treatyename, Treatytype, accperiod
    				FROM Fhtreaty
    			) d ON c.Treatyno = d.Treatyno
    			JOIN Fzplanmain a ON a.Accno = c.Accno
    				LEFT JOIN fdReins b ON a.Freinscode = b.REINSCODE
    			WHERE c.Opttype = NULL
    				AND CASE SUBSTRING(d.Treatytype, 0, 1)
    					WHEN '7' THEN CASE c.Acckind
    							WHEN 'O' THEN 0
    							WHEN 'L' THEN 0
    							ELSE 1
    						END
    					ELSE CASE d.Accperiod
    						WHEN 'P' THEN CASE c.Acckind
    								WHEN 'P' THEN 0
    								WHEN 'E' THEN 0
    								WHEN 'C' THEN 0
    								ELSE 1
    							END
    						ELSE CASE c.Acckind
    							WHEN 'I' THEN 0
    							ELSE 1
    						END
    					END
    				END = 1
    				AND c.Confirmstate = '1'
    				AND c.Acctype = '11'
    			GROUP BY c.OPTTYPE, b.longName, a.Freinscode, d.treatyename, c.Accno, a.Settledate, c.Treatyno, c.Sectionno, c.uwyear, c.Accperiod, a.Buscurrency, a.Acccurrency, a.busandaccexchrate, c.acckind, c.taxflag, c.withholdflag, c.Accreinscode, c.writtendate, c.yourref, c.youraccno, d.Treatytype, a.Settlestatus, CASE SUBSTRING(d.Treatytype, 0, 1)
    					WHEN '7' THEN a.payno
    					ELSE 1
    				END, c.Acctype, c.Facflag, c.writeOffFlag, c.writeFlag
    		) h
    			LEFT JOIN Fdcode e ON h.Acckinds = e.Codetype
    			AND h.Acctype = e.Codecode
    			AND h.opttype = e.codedesc
    			AND e.Newcodecode = 'fdsettleConfig'
    	) m
    	WHERE 1 = 1
    		AND m.Settlestatus IN ('0', '1')
    		AND STR_TO_DATE(DATE_FORMAT(m.SettleDate, '%Y-%m-%d'), '%Y-%m-%d') <= STR_TO_DATE(DATE_FORMAT(NULL, '%Y-%m-%d'), '%Y-%m-%d')
    	UNION ALL
    	SELECT m.Freinsname, m.Freinscode, m.treatyename, m.Accno, m.Riskcode
    		, m.Riskname, m.acckind, m.Repolicyno, m.Recertifyno, m.Drcertifyno
    		, m.Settledate, m.Treatyno, m.Sectionno, m.uwyear, m.Accperiod
    		, m.Buscurrency, m.balance1, m.Acccurrency, m.balance, m.Serialbalance
    		, m.Freinsbalance, m.reinsurerBalance, m.Busandaccexchrate, m.Codeename, m.Acckinds
    		, m.Taxflag, m.Withholdflag, m.Accreinscode, m.Codecname, m.Writtendate
    		, m.Yourref, m.Youraccno, m.payno, m.Settlestatus, m.Letter
    		, m.writeFlag, m.writeOffFlag, Row_Number() OVER (PARTITION BY m.Letter ORDER BY m.Codecname, m.Accperiod, m.Treatyno, m.Sectionno, m.Freinscode, m.treatyename, m.Buscurrency, m.balance1) AS Serialno, NULL AS settleApplyNo
    		, NULL AS settleApplyStatus
    	FROM (
    		SELECT h.Freinsname, h.Freinscode, h.treatyename, h.Accno, h.Riskcode
    			, h.Riskname, h.acckind, h.Repolicyno, h.Recertifyno, h.Drcertifyno
    			, h.Settledate, h.Treatyno, h.Sectionno, h.uwyear, h.Accperiod
    			, h.Buscurrency, sum(h.Busbalance) OVER (PARTITION BY h.accno) AS balance1, h.Acccurrency
    			, sum(h.Accbalance) OVER (PARTITION BY h.accno) AS balance
    			, sum(h.Accbalance) OVER (PARTITION BY h.accno, h.payno) AS Serialbalance, h.Freinsbalance
    			, h.reinsurerBalance, h.busandaccexchrate, h.acckinds, h.taxflag, h.withholdflag
    			, h.Accreinscode, h.writtendate, h.yourref, h.youraccno, h.writeFlag
    			, CASE h.Facflag
    				WHEN '1' THEN CONCAT('特约-', e.Codeename)
    				ELSE e.Codeename
    			END AS Codeename
    			, CASE e.Codetype
    				WHEN 'X' THEN '0'
    				ELSE e.Codecname
    			END AS Codecname
    			, h.Settlestatus, h.payno, h.Letter, h.writeOffFlag
    		FROM (
    			SELECT b.longName AS Freinsname, a.Freinscode, c.OPTTYPE, d.treatyename, c.Accno
    				, NULL AS Riskcode, NULL AS Riskname, '合约' AS acckind, NULL AS Repolicyno, NULL AS Recertifyno
    				, NULL AS Drcertifyno, a.Settledate, c.Treatyno, CONVERT(c.layerNo, CHAR) AS Sectionno
    				, c.uwyear
    				, CASE c.accKind
    					WHEN 'X' THEN CONVERT(a.payno, CHAR)
    					ELSE c.accPeriod
    				END AS Accperiod
    				, c.writeFlag, sum(a.Busbalance) AS Busbalance, sum(a.Accbalance) AS Accbalance
    				, Sum(a.Accbalance) - Sum(a.Accpaidvalue) AS Freinsbalance
    				, Sum(a.Busbalance) - Sum(a.busPaidValue) AS reinsurerBalance
    				, a.Buscurrency, a.Acccurrency, a.busandaccexchrate, c.acckind AS acckinds, c.taxflag
    				, c.withholdflag, c.Accreinscode, c.writtendate, c.yourref, c.youraccno
    				, a.Settlestatus
    				, CASE SUBSTRING(d.Treatytype, 0, 1)
    					WHEN '7' THEN a.payno
    					ELSE 1
    				END AS payno
    				, c.Acctype, c.Facflag
    				, CASE SUBSTRING(d.Treatytype, 0, 1)
    					WHEN '7' THEN 'B'
    					ELSE 'A'
    				END AS Letter
    				, CASE c.writeOffFlag
    					WHEN '0' THEN NULL
    					WHEN '1' THEN '冲销账'
    					ELSE '冲销账'
    				END AS writeOffFlag
    			FROM Fzacc c
    			JOIN (
    				SELECT treatyno, treatyename, Treatytype, NULL
    				FROM Fhxtreaty
    			) d ON c.Treatyno = d.Treatyno
    			JOIN Fzplanmain a ON a.Accno = c.Accno
    				LEFT JOIN fdReins b ON a.Freinscode = b.REINSCODE
    			WHERE c.Opttype = NULL
    				AND CASE SUBSTRING(d.Treatytype, 0, 1)
    					WHEN '7' THEN CASE c.Acckind
    							WHEN 'O' THEN 0
    							WHEN 'L' THEN 0
    							ELSE 1
    						END
    				END = 1
    				AND c.Confirmstate = '1'
    				AND c.Acctype = '11'
    			GROUP BY c.OPTTYPE, b.longName, a.Freinscode, d.treatyename, c.Accno, a.Settledate, c.Treatyno, c.layerNo, c.uwyear, CASE c.accKind
    					WHEN 'X' THEN CONVERT(a.payno, CHAR)
    					ELSE c.accPeriod
    				END, a.Buscurrency, a.Acccurrency, a.busandaccexchrate, c.acckind, c.taxflag, c.withholdflag, c.Accreinscode, c.writtendate, c.yourref, c.youraccno, d.Treatytype, a.Settlestatus, CASE SUBSTRING(d.Treatytype, 0, 1)
    					WHEN '7' THEN a.payno
    					ELSE 1
    				END, c.Acctype, c.Facflag, c.writeOffFlag, c.writeFlag
    		) h
    			LEFT JOIN Fdcode e ON h.Acckinds = e.Codetype
    			AND h.Acctype = e.Codecode
    			AND h.opttype = e.codedesc
    			AND e.Newcodecode = 'fdsettleConfig'
    	) m
    	WHERE 1 = 1
    		AND m.Settlestatus IN ('0', '1')
    		AND STR_TO_DATE(DATE_FORMAT(m.SettleDate, '%Y-%m-%d'), '%Y-%m-%d') <= STR_TO_DATE(DATE_FORMAT(NULL, '%Y-%m-%d'), '%Y-%m-%d')
    	UNION ALL
    	SELECT m.Freinsname, m.Freinscode, m.Insuredname AS treatyename, m.Accno, m.Riskcode
    		, m.Riskname, m.acckind, m.Repolicyno, m.Recertifyno, m.Drcertifyno
    		, m.Settledate, m.Treatyno, m.Sectionno, m.uwyear, m.Accperiod
    		, m.Buscurrency, m.balance1, m.Acccurrency, m.balance, m.Serialbalance
    		, m.Freinsbalance, m.reinsurerBalance, m.Busandaccexchrate, m.Codeename, m.Acckinds
    		, m.Taxflag, m.Withholdflag, m.Accreinscode, m.Codecname, m.Writtendate
    		, m.Yourref, m.Youraccno, m.payno, m.Settlestatus, m.Letter
    		, m.writeFlag, m.writeOffFlag, Row_Number() OVER (ORDER BY m.Codecname, m.uwyear, m.Drcertifyno, m.payno, m.Freinscode, m.Insuredname, m.Buscurrency, m.balance1) AS Serialno, m.settleApplyNo
    		, m.settleApplyStatus
    	FROM (
    		SELECT h.Freinsname, h.Freinscode, h.Insuredname, h.Accno, h.Riskcode
    			, h.Riskname, h.acckind, h.Repolicyno, h.Recertifyno, h.Drcertifyno
    			, h.Settledate, h.Treatyno, h.Sectionno, h.uwyear, h.Accperiod
    			, h.Buscurrency, h.Busbalance AS balance1, h.Acccurrency, h.Accbalance AS balance
    			, (
    				SELECT sum(ACCBALANCE)
    				FROM FZPLANMAIN x
    				WHERE x.ACCNO = h.ACCNO
    					AND x.PAYNO = h.PAYNO
    			) AS Serialbalance, h.Freinsbalance, h.reinsurerBalance, h.busandaccexchrate, h.acckinds
    			, h.taxflag, h.withholdflag, h.Accreinscode, h.writtendate, h.yourref
    			, h.youraccno, h.writeFlag
    			, CASE h.Facflag
    				WHEN '1' THEN CONCAT('特约-', e.Codeename)
    				ELSE e.Codeename
    			END AS Codeename
    			, e.Codecname, h.Settlestatus, h.payno, h.Letter, h.writeOffFlag
    			, h.settleApplyNo, h.settleApplyStatus
    		FROM (
    			SELECT b.longName AS Freinsname, a.Freinscode, c.OPTTYPE, c.Insuredname, c.Accno
    				, c.Riskcode, d.Riskcname AS Riskname
    				, CONCAT(CONCAT('临分', '-'), CASE c.Acckind
    					WHEN 'P' THEN '保单'
    					WHEN 'H' THEN '保单'
    					WHEN 'E' THEN '批单'
    					WHEN 'J' THEN '批单'
    					WHEN 'C' THEN '赔案'
    					WHEN 'K' THEN '赔案'
    					ELSE NULL
    				END) AS acckind
    				, c.Repolicyno, c.Recertifyno, c.Drcertifyno, a.Settledate, NULL AS Treatyno
    				, NULL AS Sectionno, c.uwyear, c.writeFlag, CONCAT(a.payno, NULL) AS Accperiod
    				, c.Busbalance, c.Accbalance
    				, Sum(a.Accbalance) - Sum(a.Accpaidvalue) AS Freinsbalance
    				, Sum(a.Busbalance) - Sum(a.busPaidValue) AS reinsurerBalance
    				, a.Buscurrency, a.Acccurrency, a.busandaccexchrate, c.acckind AS acckinds, c.taxflag
    				, c.withholdflag, c.Accreinscode, c.writtendate, c.yourref, c.youraccno
    				, a.Settlestatus, a.payno, c.Acctype, c.Facflag, 'C' AS Letter
    				, CASE c.writeOffFlag
    					WHEN '0' THEN NULL
    					WHEN '1' THEN '冲销账'
    					ELSE '冲销账'
    				END AS writeOffFlag
    				, a.settleApplyNo, a.settleApplyStatus
    			FROM Fzacc c
    			JOIN fdrisk d ON c.riskcode = d.riskcode
    			JOIN Fzplanmain a ON a.Accno = c.Accno
    				LEFT JOIN fdReins b ON a.Freinscode = b.REINSCODE
    			WHERE c.Opttype = NULL
    				AND c.Confirmstate = '1'
    				AND c.Acctype = '10'
    			GROUP BY c.OPTTYPE, b.longName, a.Freinscode, c.Insuredname, c.Accno, c.Riskcode, d.Riskcname, c.Repolicyno, c.Recertifyno, c.Drcertifyno, a.Settledate, c.Treatyno, c.Sectionno, c.uwyear, a.Buscurrency, a.Acccurrency, a.busandaccexchrate, c.acckind, c.taxflag, c.withholdflag, c.Accreinscode, c.writtendate, c.yourref, c.youraccno, a.Settlestatus, a.payno, c.Acctype, c.Facflag, c.writeOffFlag, c.writeFlag, a.settleApplyNo, a.settleApplyStatus, a.Accbalance, a.Busbalance, a.Accpaidvalue, a.busPaidValue, c.Accbalance, c.Busbalance
    		) h
    			LEFT JOIN Fdcode e ON h.Acckinds = e.Codetype
    			AND h.Acctype = e.Codecode
    			AND h.opttype = e.codedesc
    			AND e.Newcodecode = 'fdsettleConfig'
    	) m
    	WHERE 1 = 1
    		AND m.Settlestatus IN ('0', '1')
    		AND STR_TO_DATE(DATE_FORMAT(m.SettleDate, '%Y-%m-%d'), '%Y-%m-%d') <= STR_TO_DATE(DATE_FORMAT(NULL, '%Y-%m-%d'), '%Y-%m-%d')
    ) x
    WHERE x.Freinsbalance <> 0
    	OR x.reinsurerBalance <> 0
    ORDER BY CASE x.Acccurrency
    	WHEN 'CNY' THEN '1'
    	WHEN 'USD' THEN '2'
    	ELSE x.Acccurrency
    END, x.Letter, x.Serialno

- comment: 分出临分登记信息查询
  oracle_sql: >
    select
      aa.*,
      (
        select
          min(createdate)
        from
          ReinsValidEnquiryRegister
        where
          aa.sequenceno = sequenceno
        group by
          sequenceno) createDate
    from
      (
        select
          to_date(to_char(a.closedate, 'yyyy-mm-dd'), 'yyyy-mm-dd') as closedate,
          Decode(c.riskunitcode                                                 ,
              '0'                                                               , '整单',
                c.riskunitcode) as riskUnitCode                                 ,
          c.layerNo                                                             ,
          decode(c.riskunitcode                                                 ,
              '0'                                                               , (
                select
                  sum(ss.sharerate) / count(distinct ss.riskunitcode)
                from
                  reinsshare ss
                where
                  ss.reinsmode in ('181',
                                  '182')
                and ss.validflag    = '1'
                and ss.drecertifyno = c.certifyNo),
                (
                  select
                    sum(ss.sharerate)
                  from
                    reinsshare ss
                  where
                    ss.reinsmode in ('181',
                                    '182')
                  and ss.validflag    = '1'
                  and ss.drecertifyno = c.certifyNo
                  and ss.riskunitcode = c.riskunitcode)) as retRate   ,
          100                                            as retAllRate,
          DECODE(c.sumfacshare                                        ,
              null                                                    , 0,
                c.sumfacshare)                                           as signedLineOwn                       ,
          to_date(to_char(c.facConfirmDate, 'yyyy-mm-dd'), 'yyyy-mm-dd') as facConfirmDate                      ,
          DECODE(l.locationflag                                                                                 ,
              'D'                                                                                               , '否',
                'F'                                                                                             , '是',
                  '')      as withHoldFlag                                                                           ,
          b.recertifyno    as recertifyNo                                                                            ,
          c.cutthroughflag as cutthroughflag                                                                         ,
          a.sequenceno     as SequenceNo                                                                             ,
          DECODE(c.signdate                                                                                          ,
              null                                                                                                   , '已录单',
                '归档完毕') as BusinessStatus                                                                            ,
          DECODE(a.isBranch                                                                                          ,
              '1'                                                                                                    , '是',
                '否')           as isBranch                                                                                     ,
          a.businessstatusdesc as BusinessStatusDesc                                                                           ,
          fd.categoryname      as ClassCode                                                                                    ,
          fd.riskCName         as riskName                                                                                     ,
          a.branchName                                                                                                         ,
          a.reportno           as ReportNo                                                                                               ,
          a.branchoperatorname as BranchOperatorName                                                                                     ,
          a.operatorname       as OperatorName                                                                                           ,
          a.itemname           as ItemName                                                                                               ,
          a.riskclassname      as RiskClassName                                                                                          ,
          a.faccodename        as FacCodeName                                                                                            ,
          DECODE(c.currency                                                                                                              ,
              null                                                                                                                       , '',
                c.currency) as Currency                                                                                                  ,
          DECODE(c.gbbaseshare                                                                                                           ,
              null                                                                                                                       , 0,
                c.gbbaseshare) as CoinsRate                                                                                              ,
          c.ReinsCode                                                                                                                    ,
          (
            select
              fdr.longname
            from
              fdreins fdr
            where
              fdr.reinscode = c.reinscode) as ReinsName,
          c.Freinscode                                 ,
          (
            select
              fdr.longname
            from
              fdreins fdr
            where
              fdr.reinscode = c.freinscode) as FreinsName  ,
          c.accreinscode                    as accreinscode,
          (
            select
              fdr.longname
            from
              fdreins fdr
            where
              fdr.reinscode = c.accreinscode) as accReinsName,
          c.brokerCode                                       ,
          (
            select
              fdr.longname
            from
              fdreins fdr
            where
              fdr.reinscode = c.brokerCode) as brokerName         ,
          c.DiffFlag                                              ,
          c.certifyno as CertifyNo                                ,
          DECODE(c.endorno                                        ,
              null                                                , 'P',
                'E') as certiType                                 ,
          a.CloseCodeName CloseCode                               ,
          null as EnquiryInputDate                                ,
          ''   as AccInputDate                                    ,
          ''   as AccPaymentCode                                  ,
          ''   as AccPaymentDate                                  ,
          ''   as TelNo                                           ,
          c.AccRemarks                                            ,
          c.FacSlipFlag                                           ,
          c.FacSlipDate                                           ,
          c.facType                                               ,
          DECODE(b.amount                                         ,
              null                                                , 0,
                b.amount) as Amount                               ,
          DECODE(b.premium                                        ,
              null                                                , 0,
                b.premium) as Premium                             ,
          DECODE(b.notaxpremium                                   ,
              null                                                , 0,
                b.notaxpremium) as notaxpremium                   ,
          DECODE(b.baseamount                                     ,
              null                                                , 0,
                b.baseamount) as BaseAmount                       ,
          DECODE(b.basepremium                                    ,
              null                                                , 0,
                b.basepremium) as BasePremium                     ,
          DECODE(b.notaxbasepremium                               ,
              null                                                , 0,
                b.notaxbasepremium) as notaxbasepremium           ,
          DECODE(c.sumfacshare                                    ,
              null                                                , 0,
                c.sumfacshare) as OutSignedLine                   ,
          DECODE(c.outAmount                                      ,
              null                                                , 0,
                c.outAmount) as outAmount                         ,
          DECODE(c.outPremium                                     ,
              null                                                , 0,
                c.outPremium) as outPremium                       ,
          DECODE(c.noTaxoutPremium                                ,
              null                                                , 0,
                c.noTaxoutPremium) as noTaxoutPremium             ,
          d.amount                 as RetenAmount                 ,
          d.premium                as RetenPremium                ,
          a.claimcondition         as ClaimCondition              ,
          DECODE(a.offeredLine                                    ,
              null                                                , 0,
                a.offeredLine) as OfferedLine                     ,
          DECODE(c.sumfacshare * c.gbbaseshare / 100              ,
              null                                                , 0,
                c.sumfacshare * c.gbbaseshare / 100) as SignedLine,
          c.SpecialFacFlag                                        ,
          DECODE(c.WrittenLine                                    ,
              null                                                , 0,
                c.WrittenLine) as WrittenLine                     ,
          DECODE(c.BaseShare                                      ,
              null                                                , 0,
                c.BaseShare) as BaseShare                         ,
          DECODE(c.CommRate                                       ,
              null                                                , 0,
                c.CommRate)                  as CommRate                           ,
          0                                  as OutSumPremium                      ,
          0                                  as Commission                         ,
          0                                  as TaxFee                             ,
          0                                  as AddTaxFee                          ,
          0                                  as OtherFee                           ,
          0                                  as Balance                            ,
          to_char(c.startdate, 'yyyy-mm-dd') as StartDate                          ,
          to_char(c.enddate, 'yyyy-mm-dd')   as EndDate                            ,
          ''                                 as ExecutiveRemark                    ,
          a.remarks                          as Remarks                            ,
          c.FacilityCode                     as FacilityCode                       ,
          a.firstdate                        as FirstDate                          ,
          a.noTaskReason                     as noTaskReason                       ,
          a.takeDate                         as takeDate                           ,
          a.afterDate                        as AfterDate                          ,
          a.taskEndDate                      as taskEndDate                        ,
          c.verifyDate                       as verifyDate                         ,
          c.underWriteEndDate                as underWriteEndDate
        from
          (
            select
              drcertifyno       ,
              riskunitcode      ,
              sum(amount) amount,
              sum(premium) premium
            from
              reinsretenshare
            group by
              drcertifyno,
              riskunitcode

            union all

            select
              drcertifyno       ,
              '0'               ,
              sum(amount) amount,
              sum(premium) premium
            from
              reinsretenshare
            group by
              drcertifyno) d           ,
          ReinsValidEnquiryRegister a  ,
          Reinsenquiryregisterbinding b,
          (
            select
              r.sequenceno          ,
              r.ClassCode           ,
              r.riskcode            ,
              r.comcode             ,
              e.signdate            ,
              null         as layerNo       ,
              r.verifydate as facConfirmDate,
              e.enquiryno                   ,
              e.endorno                     ,
              r.sumamount       as sumamount      ,
              r.sumpremium      as sumpremium     ,
              r.baseshare       as gbbaseshare    ,
              r.specialfacshare as specialfacshare,
              r.facshare        as facshare       ,
              r.sumfacshare     as sumfacshare    ,
              decode(r.enquirytype                ,
                  'P'                             , r.policyno,
                    'E'                           , r.endorno) as certifyno,
              r.riskunitcode riskunitcode         ,
              r.currency       as currency              ,
              e.reinscode      as reinscode             ,
              e.accreinscode   as accreinscode          ,
              e.accReinsName   as accReinsName          ,
              e.reinsname      as ReinsName             ,
              e.finalreinscode as Freinscode            ,
              e.finalreinsname as FreinsName            ,
              e.brokercode     as brokercode            ,
              e.brokerName     as brokerName            ,
              e.DiffFlag       as DiffFlag              ,
              ''               as AccRemarks            ,
              DECODE(e.signDate                         ,
                  null                                  , '否',
                    '是')                     as FacSlipFlag                 ,
              to_char(e.signDate, 'yyyy-mm') as FacSlipDate                 ,
              decode(r.enquirytype                                          ,
                  'P'                                                       , e.amount,
                    'E'                                                     , e.chgamount,
                      0) as outAmount                                       ,
              decode(r.enquirytype                                          ,
                  'P'                                                       , e.premium,
                    'E'                                                     , e.chgpremium,
                      0) as outPremium                                      ,
              decode(r.enquirytype                                          ,
                  'P'                                                       , e.notaxpremium,
                    'E'                                                     , e.chgnotaxpremium,
                      0) as notaxOutPremium                                 ,
              e.vatfee   as taxfee                                          ,
              DECODE(e.facflag                                              ,
                  '1'                                                       , '是',
                    '否')                                         as SpecialFacFlag                                  ,
              (nvl(e.signedline, 0) * nvl(r.BaseShare, 0)) / 100 as WrittenLine                                     ,
              nvl(e.signedline, 0)                               as BaseShare                                       ,
              e.signedcomm                                       as CommRate                                        ,
              e.premium * e.signedcomm / 100                     as Commission                                      ,
              ''                                                 as FacilityCode                                    ,
              '比例临分' facType                                                                                        ,
              r.startdate                                                                                           ,
              r.enddate                                                                                             ,
              e.cutthroughflag as cutthroughflag                                                                    ,
              decode(r.verifyFlag                                                                                   ,
                  3                                                                                                 , verifyDate,
                    null) verifyDate                                                                                ,
              decode(r.enquiryType                                                                                  ,
                  'P'                                                                                               , pUnit.underWriteEndDate,
                    'E'                                                                                             , eUnit.underWriteEndDate,
                      null) underWriteEndDate                                                                       ,
              (
                select
                  (
                    case
                    when
                      count(1) = 0
                    then
                      SYSDATE
                    else
                      max(writtenDate)
                    end) writtenDate
                from
                  fzacc acc
                where
                  (
                    (
                      r.policyNo        = acc.drcertifyNo
                      and r.enquiryType = 'P')
                    or (
                      r.endorNo         = acc.drcertifyNo
                      and r.enquiryType = 'E'))
                and e.accReinsCode      = acc.accReinsCode
                and e.withHoldFlag      = acc.withHoldFlag) writtenDate
            from
              ReinsValidReceive e,
              ReinsValidEnquiry r
            left join
              ReinsPolicyUnit pUnit
            on
              r.policyNo = pUnit.policyNo
            left join
              ReinsEndorUnit eUnit
            on
              r.endorNo = eUnit.endorNo
            where
              r.enquiryno     = e.enquiryno
            and r.versionno   = e.versionno
            and e.versiondesc <> ' '
            and r.sequenceNo  <> ' '
            and r.enquirytype in ('P',
                                 'E')
            and r.validflag = '1'

            union all

            select
              r.sequenceno               ,
              r.ClassCode                ,
              r.riskcode                 ,
              r.comcode                  ,
              f.signdate                 ,
              f.layerno    as layerNo       ,
              r.verifydate as facConfirmDate,
              f.enquiryno                   ,
              r.endorno                     ,
              r.sumamount       as sumamount      ,
              r.sumpremium      as sumpremium     ,
              r.baseshare       as gbbaseshare    ,
              r.specialfacshare as specialfacshare,
              r.facshare        as facshare       ,
              0                 as sumfacshare    ,
              decode(r.enquirytype                ,
                  'P'                             , r.policyno,
                    'E'                           , r.endorno) as certifyno,
              r.riskunitcode riskunitcode         ,
              r.currency     as currency              ,
              f.reinscode    as Reinscode             ,
              f.accreinscode as accreinscode          ,
              f.accReinsName as accReinsName          ,
              f.reinsname    as ReinsName             ,
              f.freinscode   as Freinscode            ,
              f.freinsname   as FreinsName            ,
              f.brokercode   as brokercode            ,
              f.brokerName   as brokerName            ,
              DECODE(f.DiffFlag                       ,
                  '1'                                 , '费率差异',
                    '无差异') as DiffFlag                ,
              ''           as AccRemarks              ,
              '' FacSlipFlag                          ,
              '' as FacSlipDate                       ,
              0  as outAmount                         ,
              decode(r.enquirytype                    ,
                  'P'                                 , f.premium,
                    'E'                               , f.chgpreium,
                      0) as outPremium                ,
              decode(r.enquirytype                    ,
                  'P'                                 , f.notaxpremium,
                    'E'                               , f.CHGEXTAXPREMIUM,
                      0) as notaxoutPremium           ,
              f.vat      as taxfee                    ,
              DECODE(f.facflag                        ,
                  '1'                                 , '是',
                    '否')          as SpecialFacFlag            ,
              nvl(f.sharerate, 0) as WrittenLine               ,
              nvl(f.sharerate, 0) as BaseShare                 ,
              DECODE(f.COMMISSIONSRATE                         ,
                  null                                         , 0,
                    f.COMMISSIONSRATE)      as CommRate             ,
              f.premium * f.commissionsrate as Commission           ,
              ''                            as FacilityCode         ,
              '非比例临分' facType                                       ,
              r.startdate                                           ,
              r.enddate                                             ,
              '0' as cutthroughflag                                 ,
              decode(r.verifyFlag                                   ,
                  3                                                 , verifyDate,
                    null) verifyDate                                ,
              decode(r.enquiryType                                  ,
                  'P'                                               , pUnit.underWriteEndDate,
                    'E'                                             , eUnit.underWriteEndDate,
                      null) underWriteEndDate                       ,
              (
                select
                  (
                    case
                    when
                      count(1) = 0
                    then
                      SYSDATE
                    else
                      max(writtenDate)
                    end) writtenDate
                from
                  fzacc acc
                where
                  (
                    (
                      r.policyNo        = acc.drcertifyNo
                      and r.enquiryType = 'P')
                    or (
                      r.endorNo         = acc.drcertifyNo
                      and r.enquiryType = 'E'))
                and f.accReinsCode      = acc.accReinsCode
                and f.withHoldFlag      = acc.withHoldFlag
                and f.layerno           = acc.sectionNo) writtenDate
            from
              REINSVALIDXOLRECEIVE f,
              ReinsValidEnquiry r
            left join
              ReinsPolicyUnit pUnit
            on
              r.policyNo = pUnit.policyNo
            left join
              ReinsEndorUnit eUnit
            on
              r.endorNo = eUnit.endorNo
            where
              r.enquiryno     = f.enquiryno
            and r.versionno   = f.versionno
            and f.versiondesc <> ' '
            and r.sequenceNo  <> ' '
            and r.enquirytype in ('P',
                                 'E')
            and r.validflag = '1') c,
          fdCompany company         ,
          fdrisk fd                 ,
          fdReins l
        where
          c.certifyno       = b.certifyno
        and fd.riskcode(   +)  = c.riskcode
        and d.DRCERTIFYNO( +)  = c.certifyno
        and d.RISKUNITCODE(+)  = c.riskunitcode
        and fd.validStatus     = '1'
        and company.comcode(+) = a.branchcode
        and l.reinscode        = c.freinscode
        and c.riskunitcode     = b.riskunitcode
        and a.validflag        = '1'
        and a.sequenceNo       = b.sequenceNo
        and a.versionNo        = b.versionNo
        and a.sequenceNo       = c.sequenceNo
        and a.branchcode in
          (
            select
              comCode
            from
              FDCOMPANY
            where
              comPath like '%11000000%')

        union all

        select
          a.closedate as closedate                     ,
          ''          as riskUnitCode                  ,
          c.layerNo                                    ,
          decode(c.facType                             ,
              '比例临分'                                   , a.retenShare / a.coinsRate * 100,
                0)             as retRate                          ,
          nvl(a.retenShare, 0) as retAllRate                       ,
          decode(a.signedLine                                      ,
              null                                                 , 0,
                a.signedLine / a.coinsRate * 100) as signedLineOwn ,
          null                                    as facConfirmDate,
          DECODE(
            (
              select distinct
                l.locationflag
              from
                fdReins l
              where
                l.reinscode = c.freinscode),
              'D'                          , '否',
                'F'                        , '是',
                  '')          as withHoldFlag      ,
          ''                   as recertifyNo       ,
          ''                   as cutthroughflag    ,
          a.sequenceno         as SequenceNo        ,
          a.businessstatusName as BusinessStatus    ,
          DECODE(a.isBranch                         ,
              '1'                                   , '是',
                '否')           as isBranch                    ,
          a.businessstatusdesc as BusinessStatusDesc          ,
          a.classname          as classCode                   ,
          null riskName                                       ,
          a.branchname         as branchName                          ,
          a.reportno           as ReportNo                            ,
          a.branchoperatorname as BranchOperatorName                  ,
          a.operatorname       as OperatorName                        ,
          a.itemname           as ItemName                            ,
          a.riskclassname      as RiskClassName                       ,
          a.faccodename        as FacCodeName                         ,
          DECODE(a.currency                                           ,
              null                                                    , '',
                a.currency) as Currency                               ,
          DECODE(a.coinsrate                                          ,
              null                                                    , 0,
                a.coinsrate) as CoinsRate                             ,
          c.ReinsCode                                                 ,
          c.ReinsName                                                 ,
          c.Freinscode                                                ,
          c.FreinsName                                                ,
          c.accreinscode as accreinscode                              ,
          c.accReinsName                                              ,
          c.brokerCode                                                ,
          c.brokerName                                                ,
          c.DiffFlag                                                  ,
          ''              as CertifyNo                                             ,
          ''              as certiType                                             ,
          a.CloseCodeName as CloseCode                                             ,
          null            as EnquiryInputDate                                      ,
          ''              as AccInputDate                                          ,
          ''              as AccPaymentCode                                        ,
          ''              as AccPaymentDate                                        ,
          c.telno         as telNo                                                 ,
          c.AccRemarks                                                             ,
          c.FacSlipFlag                                                            ,
          c.FacSlipDate                                                            ,
          c.facType                                                                ,
          DECODE(a.amount                                                          ,
              null                                                                 , 0,
                a.amount) as Amount                                                ,
          DECODE(a.premium                                                         ,
              null                                                                 , 0,
                a.premium) as Premium                                              ,
          DECODE(a.notaxpremium                                                    ,
              null                                                                 , 0,
                a.notaxpremium) as notaxpremium                                    ,
          DECODE(a.baseamount                                                      ,
              null                                                                 , 0,
                a.baseamount) as BaseAmount                                        ,
          DECODE(a.basepremium                                                     ,
              null                                                                 , 0,
                a.basepremium) as BasePremium                                      ,
          DECODE(a.notaxbasepremium                                                ,
              null                                                                 , 0,
                a.notaxbasepremium) as notaxbasepremium                            ,
          DECODE(c.OutSignedLine                                                   ,
              null                                                                 , 0,
                c.OutSignedLine) as OutSignedLine                                  ,
          DECODE(c.outAmount                                                       ,
              null                                                                 , 0,
                c.outAmount) as outAmount                                          ,
          DECODE(c.outPremium                                                      ,
              null                                                                 , 0,
                c.outPremium) as outPremium                                        ,
          DECODE(c.noTaxoutPremium                                                 ,
              null                                                                 , 0,
                c.noTaxoutPremium) as noTaxoutPremium                              ,
          DECODE(a.retenamount                                                     ,
              null                                                                 , 0,
                a.retenamount) as RetenAmount                                      ,
          DECODE(a.retenpremium                                                    ,
              null                                                                 , 0,
                a.retenpremium) as RetenPremium                                    ,
          a.claimcondition      as ClaimCondition                                  ,
          DECODE(a.offeredline                                                     ,
              null                                                                 , 0,
                a.offeredline) as OfferedLine                                      ,
          DECODE(c.SignedLine                                                      ,
              null                                                                 , 0,
                c.SignedLine) as SignedLine                                        ,
          c.SpecialFacFlag                                                         ,
          DECODE(c.WrittenLine                                                     ,
              null                                                                 , 0,
                c.WrittenLine) as WrittenLine                                      ,
          DECODE(c.BaseShare                                                       ,
              null                                                                 , 0,
                c.BaseShare) as BaseShare                                          ,
          DECODE(c.CommRate                                                        ,
              null                                                                 , 0,
                c.CommRate) as CommRate                                            ,
          DECODE(c.noTaxoutPremium                                                 ,
              null                                                                 , 0,
                c.noTaxoutPremium) as OutSumPremium                                ,
          DECODE(c.Commission                                                      ,
              null                                                                 , 0,
                c.Commission)                as Commission                                        ,
          0                                  as TaxFee                                            ,
          0                                  as AddTaxFee                                         ,
          0                                  as OtherFee                                          ,
          0                                  as Balance                                           ,
          to_char(a.startdate, 'yyyy-mm-dd') as StartDate                                         ,
          to_char(a.enddate, 'yyyy-mm-dd')   as EndDate                                           ,
          ''                                 as ExecutiveRemark                                   ,
          a.remarks                          as Remarks                                           ,
          c.FacilityCode                     as FacilityCode                                      ,
          a.firstdate                        as FirstDate                                         ,
          a.noTaskReason                     as noTaskReason                                      ,
          a.takeDate                         as takeDate                                          ,
          null                               as AfterDate                                         ,
          a.taskEndDate                      as taskEndDate                                       ,
          null                               as verifyDate                                        ,
          null                               as underWriteEndDate
        from
          ReinsValidEnquiryRegister a
        left join
          (
            select
              null as layerNo                ,
              r.telno                        ,
              e.sequenceno                   ,
              r.reinscode  as reinscode       ,
              r.reinsname  as ReinsName       ,
              r.freinscode as Freinscode      ,
              r.freinsname as FreinsName      ,
              r.accreinscode accreinscode     ,
              r.accReinsName                  ,
              r.brokerCode                    ,
              r.brokerName                    ,
              r.DiffFlag   as DiffFlag          ,
              r.accremarks as AccRemarks        ,
              DECODE(r.facslipflag              ,
                  1                             , '是',
                    '否')                        as FacSlipFlag         ,
              to_char(r.facslipdate, 'yyyy-mm') as FacSlipDate         ,
              r.amount                          as outAmount           ,
              r.premium                         as outPremium          ,
              r.notaxpremium                    as notaxoutPremium     ,
              DECODE(r.specialfacflag                                  ,
                  '1'                                                  , '是',
                    '否')          as SpecialFacFlag                             ,
              r.WRITTENLINE       as WrittenLine                                ,
              nvl(r.BaseShare, 0) as BaseShare                                  ,
              DECODE(r.commrate                                                 ,
                  null                                                          , 0,
                    r.commrate) as CommRate                                     ,
              DECODE(r.commRate                                                 ,
                  null                                                          , 0,
                    r.commRate) * DECODE(r.premium                              ,
                  null                                                          , 0,
                    r.premium) / 100 as Commission                              ,
              DECODE(e.signedline                                               ,
                  null                                                          , 0,
                    e.signedline) as SignedLine                                 ,
              DECODE(round(e.signedline / e.coinsrate / 100, 6)                 ,
                  null                                                          , 0,
                    round(e.signedline / e.coinsrate / 100, 6)) as OutSignedLine,
              r.facilitycode facility                                           ,
              '' as FacilityCode                                                ,
              '比例临分' facType
            from
              reinsvalidenquiryregister e,
              reinsvalidenquiryregisterreins r
            where
              r.sequenceno  = e.sequenceno
            and r.versionNo = e.versionNo
            and e.validflag = '1'

            union all

            select
              f.layerNo as layerNo        ,
              f.telno                     ,
              r.sequenceno                ,
              f.reinscode  as Reinscode    ,
              f.reinsname  as ReinsName    ,
              f.freinscode as Freinscode   ,
              f.freinsname as FreinsName   ,
              f.accreinscode accreinscode  ,
              f.accReinsName               ,
              f.brokerCode                 ,
              f.brokerName                 ,
              DECODE(f.diffflag            ,
                  '1'                      , '费率差异',
                    '无差异') as DiffFlag     ,
              f.accremarks as AccRemarks   ,
              DECODE(f.facslipflag         ,
                  1                        , '是',
                    '否')                        as FacSlipFlag    ,
              to_char(f.facslipdate, 'yyyy-mm') as FacSlipDate    ,
              0                                 as outAmount      ,
              f.repremium                       as outPremium     ,
              f.noTaxrepremium                  as noTaxoutPremium,
              DECODE(f.specialfacflag                             ,
                  '1'                                             , '是',
                    '否')           as SpecialFacFlag                        ,
              nvl(f.signedline, 0) as WrittenLine                           ,
              0                    as BaseShare                             ,
              DECODE(f.commrate                                             ,
                  null                                                      , 0,
                    f.commrate) as CommRate                                 ,
              DECODE(f.commrate                                             ,
                  null                                                      , 0,
                    f.commrate) * DECODE(f.repremium                        ,
                  null                                                      , 0,
                    f.repremium) / 100 as Commission                        ,
              0                        as SignedLine                        ,
              0                        as OutSignedLine                     ,
              f.facilitycode facility                                       ,
              '' as FacilityCode                                            ,
              '非比例临分' facType
            from
              reinsvalidenquiryregisterxreins f,
              reinsvalidenquiryregister r
            where
              r.sequenceno  = f.sequenceno
            and r.versionNo = f.versionNo
            and r.validflag = '1') c
        on
          a.sequenceno = c.sequenceno
        where
          a.validflag = '1'
        and not exists
          (
            select
              1
            from
              reinsenquiryregisterbinding f
            where
              a.sequenceno = f.sequenceno)
        and a.branchcode in
          (
            select
              comCode
            from
              FDCOMPANY
            where
              comPath like '%11000000%')) aa
    where
      1 = 1
    order by
      aa.sequenceno asc,
      aa.layerno asc
  tidb_sql: >
    SELECT aa.*
    	, (
    		SELECT min(createdate)
    		FROM ReinsValidEnquiryRegister
    		WHERE aa.sequenceno = sequenceno
    		GROUP BY sequenceno
    	) AS createDate
    FROM (
    	SELECT STR_TO_DATE(DATE_FORMAT(a.closedate, '%Y-%m-%d'), '%Y-%m-%d') AS closedate
    		, CASE c.riskunitcode
    			WHEN '0' THEN '整单'
    			ELSE c.riskunitcode
    		END AS riskUnitCode
    		, c.layerNo
    		, CASE c.riskunitcode
    			WHEN '0' THEN (
    					SELECT sum(ss.sharerate) / count(DISTINCT ss.riskunitcode)
    					FROM reinsshare ss
    					WHERE ss.reinsmode IN ('181', '182')
    						AND ss.validflag = '1'
    						AND ss.drecertifyno = c.certifyNo
    				)
    			ELSE (
    				SELECT sum(ss.sharerate)
    				FROM reinsshare ss
    				WHERE ss.reinsmode IN ('181', '182')
    					AND ss.validflag = '1'
    					AND ss.drecertifyno = c.certifyNo
    					AND ss.riskunitcode = c.riskunitcode
    			)
    		END AS retRate
    		, 100 AS retAllRate
    		, CASE c.sumfacshare
    			WHEN NULL THEN 0
    			ELSE c.sumfacshare
    		END AS signedLineOwn
    		, STR_TO_DATE(DATE_FORMAT(c.facConfirmDate, '%Y-%m-%d'), '%Y-%m-%d') AS facConfirmDate
    		, CASE l.locationflag
    			WHEN 'D' THEN '否'
    			WHEN 'F' THEN '是'
    			ELSE NULL
    		END AS withHoldFlag
    		, b.recertifyno AS recertifyNo, c.cutthroughflag AS cutthroughflag, a.sequenceno AS SequenceNo
    		, CASE c.signdate
    			WHEN NULL THEN '已录单'
    			ELSE '归档完毕'
    		END AS BusinessStatus
    		, CASE a.isBranch
    			WHEN '1' THEN '是'
    			ELSE '否'
    		END AS isBranch
    		, a.businessstatusdesc AS BusinessStatusDesc, fd.categoryname AS ClassCode, fd.riskCName AS riskName, a.branchName, a.reportno AS ReportNo
    		, a.branchoperatorname AS BranchOperatorName, a.operatorname AS OperatorName, a.itemname AS ItemName, a.riskclassname AS RiskClassName, a.faccodename AS FacCodeName
    		, CASE c.currency
    			WHEN NULL THEN NULL
    			ELSE c.currency
    		END AS Currency
    		, CASE c.gbbaseshare
    			WHEN NULL THEN 0
    			ELSE c.gbbaseshare
    		END AS CoinsRate
    		, c.ReinsCode
    		, (
    			SELECT fdr.longname
    			FROM fdreins fdr
    			WHERE fdr.reinscode = c.reinscode
    		) AS ReinsName, c.Freinscode
    		, (
    			SELECT fdr.longname
    			FROM fdreins fdr
    			WHERE fdr.reinscode = c.freinscode
    		) AS FreinsName, c.accreinscode AS accreinscode
    		, (
    			SELECT fdr.longname
    			FROM fdreins fdr
    			WHERE fdr.reinscode = c.accreinscode
    		) AS accReinsName, c.brokerCode
    		, (
    			SELECT fdr.longname
    			FROM fdreins fdr
    			WHERE fdr.reinscode = c.brokerCode
    		) AS brokerName, c.DiffFlag, c.certifyno AS CertifyNo
    		, CASE c.endorno
    			WHEN NULL THEN 'P'
    			ELSE 'E'
    		END AS certiType
    		, a.CloseCodeName AS CloseCode, NULL AS EnquiryInputDate, NULL AS AccInputDate, NULL AS AccPaymentCode, NULL AS AccPaymentDate
    		, NULL AS TelNo, c.AccRemarks, c.FacSlipFlag, c.FacSlipDate, c.facType
    		, CASE b.amount
    			WHEN NULL THEN 0
    			ELSE b.amount
    		END AS Amount
    		, CASE b.premium
    			WHEN NULL THEN 0
    			ELSE b.premium
    		END AS Premium
    		, CASE b.notaxpremium
    			WHEN NULL THEN 0
    			ELSE b.notaxpremium
    		END AS notaxpremium
    		, CASE b.baseamount
    			WHEN NULL THEN 0
    			ELSE b.baseamount
    		END AS BaseAmount
    		, CASE b.basepremium
    			WHEN NULL THEN 0
    			ELSE b.basepremium
    		END AS BasePremium
    		, CASE b.notaxbasepremium
    			WHEN NULL THEN 0
    			ELSE b.notaxbasepremium
    		END AS notaxbasepremium
    		, CASE c.sumfacshare
    			WHEN NULL THEN 0
    			ELSE c.sumfacshare
    		END AS OutSignedLine
    		, CASE c.outAmount
    			WHEN NULL THEN 0
    			ELSE c.outAmount
    		END AS outAmount
    		, CASE c.outPremium
    			WHEN NULL THEN 0
    			ELSE c.outPremium
    		END AS outPremium
    		, CASE c.noTaxoutPremium
    			WHEN NULL THEN 0
    			ELSE c.noTaxoutPremium
    		END AS noTaxoutPremium
    		, d.amount AS RetenAmount, d.premium AS RetenPremium, a.claimcondition AS ClaimCondition
    		, CASE a.offeredLine
    			WHEN NULL THEN 0
    			ELSE a.offeredLine
    		END AS OfferedLine
    		, CASE c.sumfacshare * c.gbbaseshare / 100
    			WHEN NULL THEN 0
    			ELSE c.sumfacshare * c.gbbaseshare / 100
    		END AS SignedLine
    		, c.SpecialFacFlag
    		, CASE c.WrittenLine
    			WHEN NULL THEN 0
    			ELSE c.WrittenLine
    		END AS WrittenLine
    		, CASE c.BaseShare
    			WHEN NULL THEN 0
    			ELSE c.BaseShare
    		END AS BaseShare
    		, CASE c.CommRate
    			WHEN NULL THEN 0
    			ELSE c.CommRate
    		END AS CommRate
    		, 0 AS OutSumPremium, 0 AS Commission, 0 AS TaxFee, 0 AS AddTaxFee, 0 AS OtherFee
    		, 0 AS Balance, DATE_FORMAT(c.startdate, '%Y-%m-%d') AS StartDate
    		, DATE_FORMAT(c.enddate, '%Y-%m-%d') AS EndDate, NULL AS ExecutiveRemark
    		, a.remarks AS Remarks, c.FacilityCode AS FacilityCode, a.firstdate AS FirstDate, a.noTaskReason AS noTaskReason, a.takeDate AS takeDate
    		, a.afterDate AS AfterDate, a.taskEndDate AS taskEndDate, c.verifyDate AS verifyDate, c.underWriteEndDate AS underWriteEndDate
    	FROM Reinsenquiryregisterbinding b
    	JOIN (
    		SELECT r.sequenceno, r.ClassCode, r.riskcode, r.comcode, e.signdate
    			, NULL AS layerNo, r.verifydate AS facConfirmDate, e.enquiryno, e.endorno, r.sumamount AS sumamount
    			, r.sumpremium AS sumpremium, r.baseshare AS gbbaseshare, r.specialfacshare AS specialfacshare, r.facshare AS facshare, r.sumfacshare AS sumfacshare
    			, CASE r.enquirytype
    				WHEN 'P' THEN r.policyno
    				WHEN 'E' THEN r.endorno
    				ELSE r.endorno
    			END AS certifyno
    			, r.riskunitcode AS riskunitcode, r.currency AS currency, e.reinscode AS reinscode, e.accreinscode AS accreinscode, e.accReinsName AS accReinsName
    			, e.reinsname AS ReinsName, e.finalreinscode AS Freinscode, e.finalreinsname AS FreinsName, e.brokercode AS brokercode, e.brokerName AS brokerName
    			, e.DiffFlag AS DiffFlag, NULL AS AccRemarks
    			, CASE e.signDate
    				WHEN NULL THEN '否'
    				ELSE '是'
    			END AS FacSlipFlag
    			, DATE_FORMAT(e.signDate, 'yyyy-mm') AS FacSlipDate
    			, CASE r.enquirytype
    				WHEN 'P' THEN e.amount
    				WHEN 'E' THEN e.chgamount
    				ELSE 0
    			END AS outAmount
    			, CASE r.enquirytype
    				WHEN 'P' THEN e.premium
    				WHEN 'E' THEN e.chgpremium
    				ELSE 0
    			END AS outPremium
    			, CASE r.enquirytype
    				WHEN 'P' THEN e.notaxpremium
    				WHEN 'E' THEN e.chgnotaxpremium
    				ELSE 0
    			END AS notaxOutPremium
    			, e.vatfee AS taxfee
    			, CASE e.facflag
    				WHEN '1' THEN '是'
    				ELSE '否'
    			END AS SpecialFacFlag
    			, IFNULL(e.signedline, 0) * IFNULL(r.BaseShare, 0) / 100 AS WrittenLine
    			, IFNULL(e.signedline, 0) AS BaseShare, e.signedcomm AS CommRate
    			, e.premium * e.signedcomm / 100 AS Commission, NULL AS FacilityCode
    			, '比例临分' AS facType, r.startdate, r.enddate, e.cutthroughflag AS cutthroughflag
    			, CASE r.verifyFlag
    				WHEN 3 THEN verifyDate
    				ELSE NULL
    			END AS verifyDate
    			, CASE r.enquiryType
    				WHEN 'P' THEN pUnit.underWriteEndDate
    				WHEN 'E' THEN eUnit.underWriteEndDate
    				ELSE NULL
    			END AS underWriteEndDate
    			, (
    				SELECT CASE 
    						WHEN count(1) = 0 THEN NOW()
    						ELSE max(writtenDate)
    					END AS writtenDate
    				FROM fzacc acc
    				WHERE ((r.policyNo = acc.drcertifyNo
    							AND r.enquiryType = 'P')
    						OR (r.endorNo = acc.drcertifyNo
    							AND r.enquiryType = 'E'))
    					AND e.accReinsCode = acc.accReinsCode
    					AND e.withHoldFlag = acc.withHoldFlag
    			) AS writtenDate
    		FROM ReinsEndorUnit eUnit
    		RIGHT JOIN ReinsValidEnquiry r ON r.endorNo = eUnit.endorNo 
    		LEFT JOIN ReinsPolicyUnit pUnit ON r.policyNo = pUnit.policyNo 
    			JOIN ReinsValidReceive e ON r.enquiryno = e.enquiryno
    			AND r.versionno = e.versionno 
    		WHERE e.versiondesc <> ' '
    			AND r.sequenceNo <> ' '
    			AND r.validflag = '1'
    		UNION ALL
    		SELECT r.sequenceno, r.ClassCode, r.riskcode, r.comcode, f.signdate
    			, f.layerno AS layerNo, r.verifydate AS facConfirmDate, f.enquiryno, r.endorno, r.sumamount AS sumamount
    			, r.sumpremium AS sumpremium, r.baseshare AS gbbaseshare, r.specialfacshare AS specialfacshare, r.facshare AS facshare, 0 AS sumfacshare
    			, CASE r.enquirytype
    				WHEN 'P' THEN r.policyno
    				WHEN 'E' THEN r.endorno
    				ELSE r.endorno
    			END AS certifyno
    			, r.riskunitcode AS riskunitcode, r.currency AS currency, f.reinscode AS Reinscode, f.accreinscode AS accreinscode, f.accReinsName AS accReinsName
    			, f.reinsname AS ReinsName, f.freinscode AS Freinscode, f.freinsname AS FreinsName, f.brokercode AS brokercode, f.brokerName AS brokerName
    			, CASE f.DiffFlag
    				WHEN '1' THEN '费率差异'
    				ELSE '无差异'
    			END AS DiffFlag
    			, NULL AS AccRemarks, NULL AS FacSlipFlag, NULL AS FacSlipDate, 0 AS outAmount
    			, CASE r.enquirytype
    				WHEN 'P' THEN f.premium
    				WHEN 'E' THEN f.chgpreium
    				ELSE 0
    			END AS outPremium
    			, CASE r.enquirytype
    				WHEN 'P' THEN f.notaxpremium
    				WHEN 'E' THEN f.CHGEXTAXPREMIUM
    				ELSE 0
    			END AS notaxoutPremium
    			, f.vat AS taxfee
    			, CASE f.facflag
    				WHEN '1' THEN '是'
    				ELSE '否'
    			END AS SpecialFacFlag
    			, IFNULL(f.sharerate, 0) AS WrittenLine
    			, IFNULL(f.sharerate, 0) AS BaseShare
    			, CASE f.COMMISSIONSRATE
    				WHEN NULL THEN 0
    				ELSE f.COMMISSIONSRATE
    			END AS CommRate
    			, f.premium * f.commissionsrate AS Commission, NULL AS FacilityCode, '非比例临分' AS facType
    			, r.startdate, r.enddate, '0' AS cutthroughflag
    			, CASE r.verifyFlag
    				WHEN 3 THEN verifyDate
    				ELSE NULL
    			END AS verifyDate
    			, CASE r.enquiryType
    				WHEN 'P' THEN pUnit.underWriteEndDate
    				WHEN 'E' THEN eUnit.underWriteEndDate
    				ELSE NULL
    			END AS underWriteEndDate
    			, (
    				SELECT CASE 
    						WHEN count(1) = 0 THEN NOW()
    						ELSE max(writtenDate)
    					END AS writtenDate
    				FROM fzacc acc
    				WHERE ((r.policyNo = acc.drcertifyNo
    							AND r.enquiryType = 'P')
    						OR (r.endorNo = acc.drcertifyNo
    							AND r.enquiryType = 'E'))
    					AND f.accReinsCode = acc.accReinsCode
    					AND f.withHoldFlag = acc.withHoldFlag
    					AND f.layerno = acc.sectionNo
    			) AS writtenDate
    		FROM ReinsEndorUnit eUnit
    		RIGHT JOIN ReinsValidEnquiry r ON r.endorNo = eUnit.endorNo 
    		LEFT JOIN ReinsPolicyUnit pUnit ON r.policyNo = pUnit.policyNo 
    			JOIN REINSVALIDXOLRECEIVE f ON r.enquiryno = f.enquiryno
    			AND r.versionno = f.versionno 
    		WHERE f.versiondesc <> ' '
    			AND r.sequenceNo <> ' '
    			AND r.validflag = '1'
    	) c ON c.certifyno = b.certifyno
    		AND c.riskunitcode = b.riskunitcode 
    	JOIN ReinsValidEnquiryRegister a ON a.sequenceNo = b.sequenceNo
    		AND a.versionNo = b.versionNo
    		AND a.sequenceNo = c.sequenceNo 
    	LEFT JOIN fdCompany company ON a.branchcode = company.comcode 
    	JOIN fdReins l ON l.reinscode = c.freinscode 
    	LEFT JOIN fdrisk fd ON c.riskcode = fd.riskcode 
    		LEFT JOIN (
    			SELECT drcertifyno, riskunitcode, sum(amount) AS amount
    				, sum(premium) AS premium
    			FROM reinsretenshare
    			GROUP BY drcertifyno, riskunitcode
    			UNION ALL
    			SELECT drcertifyno, '0', sum(amount) AS amount
    				, sum(premium) AS premium
    			FROM reinsretenshare
    			GROUP BY drcertifyno
    		) d ON c.certifyno = d.DRCERTIFYNO
    		AND c.riskunitcode = d.RISKUNITCODE 
    	WHERE fd.validStatus = '1'
    		AND a.validflag = '1'
    	UNION ALL
    	SELECT a.closedate AS closedate, NULL AS riskUnitCode, c.layerNo
    		, CASE c.facType
    			WHEN '比例临分' THEN a.retenShare / a.coinsRate * 100
    			ELSE 0
    		END AS retRate
    		, IFNULL(a.retenShare, 0) AS retAllRate
    		, CASE a.signedLine
    			WHEN NULL THEN 0
    			ELSE a.signedLine / a.coinsRate * 100
    		END AS signedLineOwn
    		, NULL AS facConfirmDate
    		, CASE (
    				SELECT DISTINCT l.locationflag
    				FROM fdReins l
    				WHERE l.reinscode = c.freinscode
    			)
    			WHEN 'D' THEN '否'
    			WHEN 'F' THEN '是'
    			ELSE NULL
    		END AS withHoldFlag
    		, NULL AS recertifyNo, NULL AS cutthroughflag, a.sequenceno AS SequenceNo, a.businessstatusName AS BusinessStatus
    		, CASE a.isBranch
    			WHEN '1' THEN '是'
    			ELSE '否'
    		END AS isBranch
    		, a.businessstatusdesc AS BusinessStatusDesc, a.classname AS classCode, NULL AS riskName, a.branchname AS branchName, a.reportno AS ReportNo
    		, a.branchoperatorname AS BranchOperatorName, a.operatorname AS OperatorName, a.itemname AS ItemName, a.riskclassname AS RiskClassName, a.faccodename AS FacCodeName
    		, CASE a.currency
    			WHEN NULL THEN NULL
    			ELSE a.currency
    		END AS Currency
    		, CASE a.coinsrate
    			WHEN NULL THEN 0
    			ELSE a.coinsrate
    		END AS CoinsRate
    		, c.ReinsCode, c.ReinsName, c.Freinscode, c.FreinsName, c.accreinscode AS accreinscode
    		, c.accReinsName, c.brokerCode, c.brokerName, c.DiffFlag, NULL AS CertifyNo
    		, NULL AS certiType, a.CloseCodeName AS CloseCode, NULL AS EnquiryInputDate, NULL AS AccInputDate, NULL AS AccPaymentCode
    		, NULL AS AccPaymentDate, c.telno AS telNo, c.AccRemarks, c.FacSlipFlag, c.FacSlipDate
    		, c.facType
    		, CASE a.amount
    			WHEN NULL THEN 0
    			ELSE a.amount
    		END AS Amount
    		, CASE a.premium
    			WHEN NULL THEN 0
    			ELSE a.premium
    		END AS Premium
    		, CASE a.notaxpremium
    			WHEN NULL THEN 0
    			ELSE a.notaxpremium
    		END AS notaxpremium
    		, CASE a.baseamount
    			WHEN NULL THEN 0
    			ELSE a.baseamount
    		END AS BaseAmount
    		, CASE a.basepremium
    			WHEN NULL THEN 0
    			ELSE a.basepremium
    		END AS BasePremium
    		, CASE a.notaxbasepremium
    			WHEN NULL THEN 0
    			ELSE a.notaxbasepremium
    		END AS notaxbasepremium
    		, CASE c.OutSignedLine
    			WHEN NULL THEN 0
    			ELSE c.OutSignedLine
    		END AS OutSignedLine
    		, CASE c.outAmount
    			WHEN NULL THEN 0
    			ELSE c.outAmount
    		END AS outAmount
    		, CASE c.outPremium
    			WHEN NULL THEN 0
    			ELSE c.outPremium
    		END AS outPremium
    		, CASE c.noTaxoutPremium
    			WHEN NULL THEN 0
    			ELSE c.noTaxoutPremium
    		END AS noTaxoutPremium
    		, CASE a.retenamount
    			WHEN NULL THEN 0
    			ELSE a.retenamount
    		END AS RetenAmount
    		, CASE a.retenpremium
    			WHEN NULL THEN 0
    			ELSE a.retenpremium
    		END AS RetenPremium
    		, a.claimcondition AS ClaimCondition
    		, CASE a.offeredline
    			WHEN NULL THEN 0
    			ELSE a.offeredline
    		END AS OfferedLine
    		, CASE c.SignedLine
    			WHEN NULL THEN 0
    			ELSE c.SignedLine
    		END AS SignedLine
    		, c.SpecialFacFlag
    		, CASE c.WrittenLine
    			WHEN NULL THEN 0
    			ELSE c.WrittenLine
    		END AS WrittenLine
    		, CASE c.BaseShare
    			WHEN NULL THEN 0
    			ELSE c.BaseShare
    		END AS BaseShare
    		, CASE c.CommRate
    			WHEN NULL THEN 0
    			ELSE c.CommRate
    		END AS CommRate
    		, CASE c.noTaxoutPremium
    			WHEN NULL THEN 0
    			ELSE c.noTaxoutPremium
    		END AS OutSumPremium
    		, CASE c.Commission
    			WHEN NULL THEN 0
    			ELSE c.Commission
    		END AS Commission
    		, 0 AS TaxFee, 0 AS AddTaxFee, 0 AS OtherFee, 0 AS Balance
    		, DATE_FORMAT(a.startdate, '%Y-%m-%d') AS StartDate
    		, DATE_FORMAT(a.enddate, '%Y-%m-%d') AS EndDate, NULL AS ExecutiveRemark
    		, a.remarks AS Remarks, c.FacilityCode AS FacilityCode, a.firstdate AS FirstDate, a.noTaskReason AS noTaskReason, a.takeDate AS takeDate
    		, NULL AS AfterDate, a.taskEndDate AS taskEndDate, NULL AS verifyDate, NULL AS underWriteEndDate
    	FROM ReinsValidEnquiryRegister a
    		LEFT JOIN (
    			SELECT NULL AS layerNo, r.telno, e.sequenceno, r.reinscode AS reinscode, r.reinsname AS ReinsName
    				, r.freinscode AS Freinscode, r.freinsname AS FreinsName, r.accreinscode AS accreinscode, r.accReinsName, r.brokerCode
    				, r.brokerName, r.DiffFlag AS DiffFlag, r.accremarks AS AccRemarks
    				, CASE r.facslipflag
    					WHEN 1 THEN '是'
    					ELSE '否'
    				END AS FacSlipFlag
    				, DATE_FORMAT(r.facslipdate, 'yyyy-mm') AS FacSlipDate, r.amount AS outAmount
    				, r.premium AS outPremium, r.notaxpremium AS notaxoutPremium
    				, CASE r.specialfacflag
    					WHEN '1' THEN '是'
    					ELSE '否'
    				END AS SpecialFacFlag
    				, r.WRITTENLINE AS WrittenLine, IFNULL(r.BaseShare, 0) AS BaseShare
    				, CASE r.commrate
    					WHEN NULL THEN 0
    					ELSE r.commrate
    				END AS CommRate
    				, CASE r.commRate
    					WHEN NULL THEN 0
    					ELSE r.commRate
    				END * CASE r.premium
    					WHEN NULL THEN 0
    					ELSE r.premium
    				END / 100 AS Commission
    				, CASE e.signedline
    					WHEN NULL THEN 0
    					ELSE e.signedline
    				END AS SignedLine
    				, CASE round(e.signedline / e.coinsrate / 100, 6)
    					WHEN NULL THEN 0
    					ELSE round(e.signedline / e.coinsrate / 100, 6)
    				END AS OutSignedLine
    				, r.facilitycode AS facility, NULL AS FacilityCode, '比例临分' AS facType
    			FROM reinsvalidenquiryregister e
    				JOIN reinsvalidenquiryregisterreins r ON r.sequenceno = e.sequenceno
    				AND r.versionNo = e.versionNo 
    			WHERE e.validflag = '1'
    			UNION ALL
    			SELECT f.layerNo AS layerNo, f.telno, r.sequenceno, f.reinscode AS Reinscode, f.reinsname AS ReinsName
    				, f.freinscode AS Freinscode, f.freinsname AS FreinsName, f.accreinscode AS accreinscode, f.accReinsName, f.brokerCode
    				, f.brokerName
    				, CASE f.diffflag
    					WHEN '1' THEN '费率差异'
    					ELSE '无差异'
    				END AS DiffFlag
    				, f.accremarks AS AccRemarks
    				, CASE f.facslipflag
    					WHEN 1 THEN '是'
    					ELSE '否'
    				END AS FacSlipFlag
    				, DATE_FORMAT(f.facslipdate, 'yyyy-mm') AS FacSlipDate, 0 AS outAmount
    				, f.repremium AS outPremium, f.noTaxrepremium AS noTaxoutPremium
    				, CASE f.specialfacflag
    					WHEN '1' THEN '是'
    					ELSE '否'
    				END AS SpecialFacFlag
    				, IFNULL(f.signedline, 0) AS WrittenLine, 0 AS BaseShare
    				, CASE f.commrate
    					WHEN NULL THEN 0
    					ELSE f.commrate
    				END AS CommRate
    				, CASE f.commrate
    					WHEN NULL THEN 0
    					ELSE f.commrate
    				END * CASE f.repremium
    					WHEN NULL THEN 0
    					ELSE f.repremium
    				END / 100 AS Commission
    				, 0 AS SignedLine, 0 AS OutSignedLine, f.facilitycode AS facility, NULL AS FacilityCode, '非比例临分' AS facType
    			FROM reinsvalidenquiryregisterxreins f
    				JOIN reinsvalidenquiryregister r ON r.sequenceno = f.sequenceno
    				AND r.versionNo = f.versionNo 
    			WHERE r.validflag = '1'
    		) c ON a.sequenceno = c.sequenceno 
    	WHERE a.validflag = '1'
    ) aa
    WHERE 1 = 1
    ORDER BY aa.sequenceno ASC, aa.layerno ASC


- comment: 分出临分登记信息导出 --- 分保部分
  oracle_sql: >
    select
      aa.*,
      (
        select
          min(s.createdate)
        from
          ReinsValidEnquiryRegister s
        where
          aa.sequenceno = s.sequenceno
        group by
          s.sequenceno) createDate,
      (
        SELECT
          max(decode(bb.businessStatus              ,
              '1'                                   , bb.businessStatusname,
                '')) || max(decode(bb.businessStatus,
              '2'                                   , '->' || bb.businessStatusname,
                '')) || max(decode(bb.businessStatus,
              '3'                                   , '->' || bb.businessStatusname,
                '')) || max(decode(bb.businessStatus,
              '4'                                   , '->' || bb.businessStatusname,
                '')) || max(decode(bb.businessStatus,
              '5'                                   , '->' || bb.businessStatusname,
                '')) || max(decode(bb.businessStatus,
              '6'                                   , '->' || bb.businessStatusname,
                '')) || max(decode(bb.businessStatus,
              '7'                                   , '->' || bb.businessStatusname,
                '')) workflow
        FROM
          Reinsvalidenquiryregisterverify bb
        where
          bb.sequenceNo = aa.sequenceNo
        group by
          bb.sequenceNo) workflow
    from
      (
        select
          to_date(to_char(a.closedate, 'yyyy-mm-dd'), 'yyyy-mm-dd') as closedate,
          Decode(c.riskunitcode                                                 ,
              '0'                                                               , '整单',
                c.riskunitcode) as riskUnitCode                                 ,
          c.layerNo                                                             ,
          decode(c.riskunitcode                                                 ,
              '0'                                                               , (
                select
                  sum(ss.sharerate) / count(distinct ss.riskunitcode)
                from
                  reinsshare ss
                where
                  ss.reinsmode in ('181',
                                  '182')
                and ss.validflag    = '1'
                and ss.drecertifyno = c.certifyNo),
                (
                  select
                    sum(ss.sharerate)
                  from
                    reinsshare ss
                  where
                    ss.reinsmode in ('181',
                                    '182')
                  and ss.validflag    = '1'
                  and ss.drecertifyno = c.certifyNo
                  and ss.riskunitcode = c.riskunitcode)) as retRate   ,
          100                                            as retAllRate,
          DECODE(c.sumfacshare                                        ,
              null                                                    , 0,
                c.sumfacshare)                                           as signedLineOwn                       ,
          to_date(to_char(c.facConfirmDate, 'yyyy-mm-dd'), 'yyyy-mm-dd') as facConfirmDate                      ,
          DECODE(l.locationflag                                                                                 ,
              'D'                                                                                               , '否',
                'F'                                                                                             , '是',
                  '')      as withHoldFlag                                                                           ,
          b.recertifyno    as recertifyNo                                                                            ,
          c.cutthroughflag as cutthroughflag                                                                         ,
          a.sequenceno     as SequenceNo                                                                             ,
          DECODE(c.signdate                                                                                          ,
              null                                                                                                   , '已录单',
                '归档完毕') as BusinessStatus                                                                            ,
          DECODE(a.isBranch                                                                                          ,
              '1'                                                                                                    , '是',
                '否')           as isBranch                                                                                     ,
          a.businessstatusdesc as BusinessStatusDesc                                                                           ,
          fd.categoryname      as ClassCode                                                                                    ,
          fd.riskCName         as riskName                                                                                     ,
          a.branchName                                                                                                         ,
          a.reportno           as ReportNo                                                                                               ,
          a.branchoperatorname as BranchOperatorName                                                                                     ,
          a.operatorname       as OperatorName                                                                                           ,
          a.itemname           as ItemName                                                                                               ,
          a.riskclassname      as RiskClassName                                                                                          ,
          a.faccodename        as FacCodeName                                                                                            ,
          DECODE(c.currency                                                                                                              ,
              null                                                                                                                       , '',
                c.currency) as Currency                                                                                                  ,
          DECODE(c.gbbaseshare                                                                                                           ,
              null                                                                                                                       , 0,
                c.gbbaseshare) as CoinsRate                                                                                              ,
          c.ReinsCode                                                                                                                    ,
          (
            select
              fdr.longname
            from
              fdreins fdr
            where
              fdr.reinscode = c.reinscode) as ReinsName,
          c.Freinscode                                 ,
          (
            select
              fdr.longname
            from
              fdreins fdr
            where
              fdr.reinscode = c.freinscode) as FreinsName  ,
          c.accreinscode                    as accreinscode,
          (
            select
              fdr.longname
            from
              fdreins fdr
            where
              fdr.reinscode = c.accreinscode) as accReinsName,
          c.brokerCode                                       ,
          (
            select
              fdr.longname
            from
              fdreins fdr
            where
              fdr.reinscode = c.brokerCode) as brokerName         ,
          c.DiffFlag                                              ,
          c.certifyno as CertifyNo                                ,
          DECODE(c.endorno                                        ,
              null                                                , 'P',
                'E') as certiType                                 ,
          a.CloseCodeName CloseCode                               ,
          null as EnquiryInputDate                                ,
          ''   as AccInputDate                                    ,
          ''   as AccPaymentCode                                  ,
          ''   as AccPaymentDate                                  ,
          ''   as TelNo                                           ,
          c.AccRemarks                                            ,
          c.FacSlipFlag                                           ,
          c.FacSlipDate                                           ,
          c.facType                                               ,
          DECODE(b.amount                                         ,
              null                                                , 0,
                b.amount) as Amount                               ,
          DECODE(b.premium                                        ,
              null                                                , 0,
                b.premium) as Premium                             ,
          DECODE(b.notaxpremium                                   ,
              null                                                , 0,
                b.notaxpremium) as notaxpremium                   ,
          DECODE(b.baseamount                                     ,
              null                                                , 0,
                b.baseamount) as BaseAmount                       ,
          DECODE(b.basepremium                                    ,
              null                                                , 0,
                b.basepremium) as BasePremium                     ,
          DECODE(b.notaxbasepremium                               ,
              null                                                , 0,
                b.notaxbasepremium) as notaxbasepremium           ,
          DECODE(c.sumfacshare                                    ,
              null                                                , 0,
                c.sumfacshare) as OutSignedLine                   ,
          DECODE(c.outAmount                                      ,
              null                                                , 0,
                c.outAmount) as outAmount                         ,
          DECODE(c.outPremium                                     ,
              null                                                , 0,
                c.outPremium) as outPremium                       ,
          DECODE(c.noTaxoutPremium                                ,
              null                                                , 0,
                c.noTaxoutPremium) as noTaxoutPremium             ,
          d.amount                 as RetenAmount                 ,
          d.premium                as RetenPremium                ,
          a.claimcondition         as ClaimCondition              ,
          DECODE(a.offeredLine                                    ,
              null                                                , 0,
                a.offeredLine) as OfferedLine                     ,
          DECODE(c.sumfacshare * c.gbbaseshare / 100              ,
              null                                                , 0,
                c.sumfacshare * c.gbbaseshare / 100) as SignedLine,
          c.SpecialFacFlag                                        ,
          DECODE(c.WrittenLine                                    ,
              null                                                , 0,
                c.WrittenLine) as WrittenLine                     ,
          DECODE(c.BaseShare                                      ,
              null                                                , 0,
                c.BaseShare) as BaseShare                         ,
          DECODE(c.CommRate                                       ,
              null                                                , 0,
                c.CommRate)                  as CommRate                           ,
          0                                  as OutSumPremium                      ,
          0                                  as Commission                         ,
          0                                  as TaxFee                             ,
          0                                  as AddTaxFee                          ,
          0                                  as OtherFee                           ,
          0                                  as Balance                            ,
          to_char(c.startdate, 'yyyy-mm-dd') as StartDate                          ,
          to_char(c.enddate, 'yyyy-mm-dd')   as EndDate                            ,
          ''                                 as ExecutiveRemark                    ,
          a.remarks                          as Remarks                            ,
          c.FacilityCode                     as FacilityCode                       ,
          a.firstdate                        as FirstDate                          ,
          a.noTaskReason                     as noTaskReason                       ,
          a.takeDate                         as takeDate                           ,
          a.afterDate                        as AfterDate                          ,
          a.taskEndDate                      as taskEndDate                        ,
          c.verifyDate                       as verifyDate                         ,
          c.underWriteEndDate                as underWriteEndDate                  ,
          c.underWriteEndDate operateDate                                          ,
          decode(a.BusinessStatus                                                  ,
              '1'                                                                  , b.bindVersionNo || '(排分中)',
                b.bindVersionNo || '(排分中已获得承保能力)') versionNo                       ,
          a.validStatus
        from
          (
            select
              drcertifyno       ,
              riskunitcode      ,
              sum(amount) amount,
              sum(premium) premium
            from
              reinsretenshare
            group by
              drcertifyno,
              riskunitcode

            union all

            select
              drcertifyno       ,
              '0'               ,
              sum(amount) amount,
              sum(premium) premium
            from
              reinsretenshare
            group by
              drcertifyno) d                    ,
          ReinsValidEnquiryRegister a           ,
          Reinsenquiryregisterbinding b         ,
          ReinsValidEnquiryRegisterVerify Verify,
          (
            select
              r.sequenceno          ,
              r.ClassCode           ,
              r.riskcode            ,
              r.comcode             ,
              e.signdate            ,
              null         as layerNo       ,
              r.verifydate as facConfirmDate,
              e.enquiryno                   ,
              e.endorno                     ,
              r.sumamount       as sumamount      ,
              r.sumpremium      as sumpremium     ,
              r.baseshare       as gbbaseshare    ,
              r.specialfacshare as specialfacshare,
              r.facshare        as facshare       ,
              r.sumfacshare     as sumfacshare    ,
              decode(r.enquirytype                ,
                  'P'                             , r.policyno,
                    'E'                           , r.endorno) as certifyno,
              r.riskunitcode riskunitcode         ,
              r.currency       as currency              ,
              e.reinscode      as reinscode             ,
              e.accreinscode   as accreinscode          ,
              e.accReinsName   as accReinsName          ,
              e.reinsname      as ReinsName             ,
              e.finalreinscode as Freinscode            ,
              e.finalreinsname as FreinsName            ,
              e.brokercode     as brokercode            ,
              e.brokerName     as brokerName            ,
              e.DiffFlag       as DiffFlag              ,
              ''               as AccRemarks            ,
              DECODE(e.signDate                         ,
                  null                                  , '否',
                    '是')                     as FacSlipFlag                 ,
              to_char(e.signDate, 'yyyy-mm') as FacSlipDate                 ,
              decode(r.enquirytype                                          ,
                  'P'                                                       , e.amount,
                    'E'                                                     , e.chgamount,
                      0) as outAmount                                       ,
              decode(r.enquirytype                                          ,
                  'P'                                                       , e.premium,
                    'E'                                                     , e.chgpremium,
                      0) as outPremium                                      ,
              decode(r.enquirytype                                          ,
                  'P'                                                       , e.notaxpremium,
                    'E'                                                     , e.chgnotaxpremium,
                      0) as notaxOutPremium                                 ,
              e.vatfee   as taxfee                                          ,
              DECODE(e.facflag                                              ,
                  '1'                                                       , '是',
                    '否')                                         as SpecialFacFlag                                  ,
              (nvl(e.signedline, 0) * nvl(r.BaseShare, 0)) / 100 as WrittenLine                                     ,
              nvl(e.signedline, 0)                               as BaseShare                                       ,
              e.signedcomm                                       as CommRate                                        ,
              e.premium * e.signedcomm / 100                     as Commission                                      ,
              ''                                                 as FacilityCode                                    ,
              '比例临分' facType                                                                                        ,
              r.startdate                                                                                           ,
              r.enddate                                                                                             ,
              e.cutthroughflag as cutthroughflag                                                                    ,
              decode(r.verifyFlag                                                                                   ,
                  3                                                                                                 , verifyDate,
                    null) verifyDate                                                                                ,
              decode(r.enquiryType                                                                                  ,
                  'P'                                                                                               , pUnit.underWriteEndDate,
                    'E'                                                                                             , eUnit.underWriteEndDate,
                      null) underWriteEndDate                                                                       ,
              (
                select
                  (
                    case
                    when
                      count(1) = 0
                    then
                      SYSDATE
                    else
                      max(writtenDate)
                    end) writtenDate
                from
                  fzacc acc
                where
                  (
                    (
                      r.policyNo        = acc.drcertifyNo
                      and r.enquiryType = 'P')
                    or (
                      r.endorNo         = acc.drcertifyNo
                      and r.enquiryType = 'E'))
                and e.accReinsCode      = acc.accReinsCode
                and e.withHoldFlag      = acc.withHoldFlag) writtenDate
            from
              ReinsValidReceive e,
              ReinsValidEnquiry r
            left join
              ReinsPolicyUnit pUnit
            on
              r.policyNo = pUnit.policyNo
            left join
              ReinsEndorUnit eUnit
            on
              r.endorNo = eUnit.endorNo
            where
              r.enquiryno     = e.enquiryno
            and r.versionno   = e.versionno
            and e.versiondesc <> ' '
            and r.sequenceNo  <> ' '
            and r.enquirytype in ('P',
                                 'E')
            and r.validflag = '1'

            union all

            select
              r.sequenceno               ,
              r.ClassCode                ,
              r.riskcode                 ,
              r.comcode                  ,
              f.signdate                 ,
              f.layerno    as layerNo       ,
              r.verifydate as facConfirmDate,
              f.enquiryno                   ,
              r.endorno                     ,
              r.sumamount       as sumamount      ,
              r.sumpremium      as sumpremium     ,
              r.baseshare       as gbbaseshare    ,
              r.specialfacshare as specialfacshare,
              r.facshare        as facshare       ,
              0                 as sumfacshare    ,
              decode(r.enquirytype                ,
                  'P'                             , r.policyno,
                    'E'                           , r.endorno) as certifyno,
              r.riskunitcode riskunitcode         ,
              r.currency     as currency              ,
              f.reinscode    as Reinscode             ,
              f.accreinscode as accreinscode          ,
              f.accReinsName as accReinsName          ,
              f.reinsname    as ReinsName             ,
              f.freinscode   as Freinscode            ,
              f.freinsname   as FreinsName            ,
              f.brokercode   as brokercode            ,
              f.brokerName   as brokerName            ,
              DECODE(f.DiffFlag                       ,
                  '1'                                 , '费率差异',
                    '无差异') as DiffFlag                ,
              ''           as AccRemarks              ,
              '' FacSlipFlag                          ,
              '' as FacSlipDate                       ,
              0  as outAmount                         ,
              decode(r.enquirytype                    ,
                  'P'                                 , f.premium,
                    'E'                               , f.chgpreium,
                      0) as outPremium                ,
              decode(r.enquirytype                    ,
                  'P'                                 , f.notaxpremium,
                    'E'                               , f.CHGEXTAXPREMIUM,
                      0) as notaxoutPremium           ,
              f.vat      as taxfee                    ,
              DECODE(f.facflag                        ,
                  '1'                                 , '是',
                    '否')          as SpecialFacFlag            ,
              nvl(f.sharerate, 0) as WrittenLine               ,
              nvl(f.sharerate, 0) as BaseShare                 ,
              DECODE(f.COMMISSIONSRATE                         ,
                  null                                         , 0,
                    f.COMMISSIONSRATE)      as CommRate             ,
              f.premium * f.commissionsrate as Commission           ,
              ''                            as FacilityCode         ,
              '非比例临分' facType                                       ,
              r.startdate                                           ,
              r.enddate                                             ,
              '0' as cutthroughflag                                 ,
              decode(r.verifyFlag                                   ,
                  3                                                 , verifyDate,
                    null) verifyDate                                ,
              decode(r.enquiryType                                  ,
                  'P'                                               , pUnit.underWriteEndDate,
                    'E'                                             , eUnit.underWriteEndDate,
                      null) underWriteEndDate                       ,
              (
                select
                  (
                    case
                    when
                      count(1) = 0
                    then
                      SYSDATE
                    else
                      max(writtenDate)
                    end) writtenDate
                from
                  fzacc acc
                where
                  (
                    (
                      r.policyNo        = acc.drcertifyNo
                      and r.enquiryType = 'P')
                    or (
                      r.endorNo         = acc.drcertifyNo
                      and r.enquiryType = 'E'))
                and f.accReinsCode      = acc.accReinsCode
                and f.withHoldFlag      = acc.withHoldFlag
                and f.layerno           = acc.sectionNo) writtenDate
            from
              REINSVALIDXOLRECEIVE f,
              ReinsValidEnquiry r
            left join
              ReinsPolicyUnit pUnit
            on
              r.policyNo = pUnit.policyNo
            left join
              ReinsEndorUnit eUnit
            on
              r.endorNo = eUnit.endorNo
            where
              r.enquiryno     = f.enquiryno
            and r.versionno   = f.versionno
            and f.versiondesc <> ' '
            and r.sequenceNo  <> ' '
            and r.enquirytype in ('P',
                                 'E')
            and r.validflag = '1') c,
          fdrisk fd                 ,
          fdCompany company         ,
          fdReins l
        where
          c.certifyno        = b.certifyno
        and fd.riskcode      = c.riskcode
        and l.reinscode      = c.freinscode
        and company.comcode  = a.branchcode
        and d.DRCERTIFYNO( +) = c.certifyno
        and d.RISKUNITCODE(+) = c.riskunitcode
        and fd.validStatus    = '1'
        and c.riskunitcode    = b.riskunitcode
        and a.validflag       = '1'
        and a.sequenceNo      = b.sequenceNo
        and a.versionno       = b.versionno
        and a.sequenceNo      = c.sequenceNo
        and a.sequenceNo      = verify.sequenceNo
        and a.versionno       = verify.versionno
        and a.branchcode in
          (
            select
              comCode
            from
              FDCOMPANY
            where
              comPath like '%11000000%')

        union all

        select
          a.closedate as closedate                     ,
          ''          as riskUnitCode                  ,
          c.layerNo                                    ,
          decode(c.facType                             ,
              '比例临分'                                   , a.retenShare / a.coinsRate * 100,
                0)             as retRate                          ,
          nvl(a.retenShare, 0) as retAllRate                       ,
          decode(a.signedLine                                      ,
              null                                                 , 0,
                a.signedLine / a.coinsRate * 100) as signedLineOwn ,
          null                                    as facConfirmDate,
          DECODE(
            (
              select distinct
                l.locationflag
              from
                fdReins l
              where
                l.reinscode = c.freinscode),
              'D'                          , '否',
                'F'                        , '是',
                  '')          as withHoldFlag      ,
          ''                   as recertifyNo       ,
          ''                   as cutthroughflag    ,
          a.sequenceno         as SequenceNo        ,
          a.businessstatusName as BusinessStatus    ,
          DECODE(a.isBranch                         ,
              '1'                                   , '是',
                '否')           as isBranch                    ,
          a.businessstatusdesc as BusinessStatusDesc          ,
          a.classname          as classCode                   ,
          null riskName                                       ,
          a.branchname         as branchName                          ,
          a.reportno           as ReportNo                            ,
          a.branchoperatorname as BranchOperatorName                  ,
          a.operatorname       as OperatorName                        ,
          a.itemname           as ItemName                            ,
          a.riskclassname      as RiskClassName                       ,
          a.faccodename        as FacCodeName                         ,
          DECODE(a.currency                                           ,
              null                                                    , '',
                a.currency) as Currency                               ,
          DECODE(a.coinsrate                                          ,
              null                                                    , 0,
                a.coinsrate) as CoinsRate                             ,
          c.ReinsCode                                                 ,
          c.ReinsName                                                 ,
          c.Freinscode                                                ,
          c.FreinsName                                                ,
          c.accreinscode as accreinscode                              ,
          c.accReinsName                                              ,
          c.brokerCode                                                ,
          c.brokerName                                                ,
          c.DiffFlag                                                  ,
          ''              as CertifyNo                                             ,
          ''              as certiType                                             ,
          a.CloseCodeName as CloseCode                                             ,
          null            as EnquiryInputDate                                      ,
          ''              as AccInputDate                                          ,
          ''              as AccPaymentCode                                        ,
          ''              as AccPaymentDate                                        ,
          c.telno         as telNo                                                 ,
          c.AccRemarks                                                             ,
          c.FacSlipFlag                                                            ,
          c.FacSlipDate                                                            ,
          c.facType                                                                ,
          DECODE(a.amount                                                          ,
              null                                                                 , 0,
                a.amount) as Amount                                                ,
          DECODE(a.premium                                                         ,
              null                                                                 , 0,
                a.premium) as Premium                                              ,
          DECODE(a.notaxpremium                                                    ,
              null                                                                 , 0,
                a.notaxpremium) as notaxpremium                                    ,
          DECODE(a.baseamount                                                      ,
              null                                                                 , 0,
                a.baseamount) as BaseAmount                                        ,
          DECODE(a.basepremium                                                     ,
              null                                                                 , 0,
                a.basepremium) as BasePremium                                      ,
          DECODE(a.notaxbasepremium                                                ,
              null                                                                 , 0,
                a.notaxbasepremium) as notaxbasepremium                            ,
          DECODE(c.OutSignedLine                                                   ,
              null                                                                 , 0,
                c.OutSignedLine) as OutSignedLine                                  ,
          DECODE(c.outAmount                                                       ,
              null                                                                 , 0,
                c.outAmount) as outAmount                                          ,
          DECODE(c.outPremium                                                      ,
              null                                                                 , 0,
                c.outPremium) as outPremium                                        ,
          DECODE(c.noTaxoutPremium                                                 ,
              null                                                                 , 0,
                c.noTaxoutPremium) as noTaxoutPremium                              ,
          DECODE(a.retenamount                                                     ,
              null                                                                 , 0,
                a.retenamount) as RetenAmount                                      ,
          DECODE(a.retenpremium                                                    ,
              null                                                                 , 0,
                a.retenpremium) as RetenPremium                                    ,
          a.claimcondition      as ClaimCondition                                  ,
          DECODE(a.offeredline                                                     ,
              null                                                                 , 0,
                a.offeredline) as OfferedLine                                      ,
          DECODE(c.SignedLine                                                      ,
              null                                                                 , 0,
                c.SignedLine) as SignedLine                                        ,
          c.SpecialFacFlag                                                         ,
          DECODE(c.WrittenLine                                                     ,
              null                                                                 , 0,
                c.WrittenLine) as WrittenLine                                      ,
          DECODE(c.BaseShare                                                       ,
              null                                                                 , 0,
                c.BaseShare) as BaseShare                                          ,
          DECODE(c.CommRate                                                        ,
              null                                                                 , 0,
                c.CommRate) as CommRate                                            ,
          DECODE(c.noTaxoutPremium                                                 ,
              null                                                                 , 0,
                c.noTaxoutPremium) as OutSumPremium                                ,
          DECODE(c.Commission                                                      ,
              null                                                                 , 0,
                c.Commission)                as Commission                                        ,
          0                                  as TaxFee                                            ,
          0                                  as AddTaxFee                                         ,
          0                                  as OtherFee                                          ,
          0                                  as Balance                                           ,
          to_char(a.startdate, 'yyyy-mm-dd') as StartDate                                         ,
          to_char(a.enddate, 'yyyy-mm-dd')   as EndDate                                           ,
          ''                                 as ExecutiveRemark                                   ,
          a.remarks                          as Remarks                                           ,
          c.FacilityCode                     as FacilityCode                                      ,
          a.firstdate                        as FirstDate                                         ,
          a.noTaskReason                     as noTaskReason                                      ,
          a.takeDate                         as takeDate                                          ,
          null                               as AfterDate                                         ,
          a.taskEndDate                      as taskEndDate                                       ,
          null                               as verifyDate                                        ,
          null                               as underWriteEndDate                                 ,
          verify.operateDate                                                                      ,
          decode(a.BusinessStatus                                                                 ,
              '1'                                                                                 , a.versionno || '（排分中)',
                a.versionNo || '(排分中已获得承保能力)') versionNo                                          ,
          a.validStatus
        from
          ReinsValidEnquiryRegister a
        left join
          ReinsValidEnquiryRegisterVerify Verify
        on
          a. sequenceno = Verify.sequenceno
        and a.versionno = Verify.versionNo
        left join
          (
            select
              null as layerNo                ,
              r.telno                        ,
              e.sequenceno                   ,
              r.reinscode  as reinscode       ,
              r.reinsname  as ReinsName       ,
              r.freinscode as Freinscode      ,
              r.freinsname as FreinsName      ,
              r.accreinscode accreinscode     ,
              r.accReinsName                  ,
              r.brokerCode                    ,
              r.brokerName                    ,
              r.DiffFlag   as DiffFlag          ,
              r.accremarks as AccRemarks        ,
              DECODE(r.facslipflag              ,
                  1                             , '是',
                    '否')                        as FacSlipFlag         ,
              to_char(r.facslipdate, 'yyyy-mm') as FacSlipDate         ,
              r.amount                          as outAmount           ,
              r.premium                         as outPremium          ,
              r.notaxpremium                    as notaxoutPremium     ,
              DECODE(r.specialfacflag                                  ,
                  '1'                                                  , '是',
                    '否')          as SpecialFacFlag                             ,
              r.WRITTENLINE       as WrittenLine                                ,
              nvl(r.BaseShare, 0) as BaseShare                                  ,
              DECODE(r.commrate                                                 ,
                  null                                                          , 0,
                    r.commrate) as CommRate                                     ,
              DECODE(r.commRate                                                 ,
                  null                                                          , 0,
                    r.commRate) * DECODE(r.premium                              ,
                  null                                                          , 0,
                    r.premium) / 100 as Commission                              ,
              DECODE(e.signedline                                               ,
                  null                                                          , 0,
                    e.signedline) as SignedLine                                 ,
              DECODE(round(e.signedline / e.coinsrate / 100, 6)                 ,
                  null                                                          , 0,
                    round(e.signedline / e.coinsrate / 100, 6)) as OutSignedLine,
              r.facilitycode facility                                           ,
              '' as FacilityCode                                                ,
              '比例临分' facType                                                    ,
              e.versionNo
            from
              reinsvalidenquiryregister e,
              reinsvalidenquiryregisterreins r
            where
              r.sequenceno  = e.sequenceno
            and e.versionno = r.versionno

            union all

            select
              f.layerNo as layerNo        ,
              f.telno                     ,
              r.sequenceno                ,
              f.reinscode  as Reinscode    ,
              f.reinsname  as ReinsName    ,
              f.freinscode as Freinscode   ,
              f.freinsname as FreinsName   ,
              f.accreinscode accreinscode  ,
              f.accReinsName               ,
              f.brokerCode                 ,
              f.brokerName                 ,
              DECODE(f.diffflag            ,
                  '1'                      , '费率差异',
                    '无差异') as DiffFlag     ,
              f.accremarks as AccRemarks   ,
              DECODE(f.facslipflag         ,
                  1                        , '是',
                    '否')                        as FacSlipFlag    ,
              to_char(f.facslipdate, 'yyyy-mm') as FacSlipDate    ,
              0                                 as outAmount      ,
              f.repremium                       as outPremium     ,
              f.noTaxrepremium                  as noTaxoutPremium,
              DECODE(f.specialfacflag                             ,
                  '1'                                             , '是',
                    '否')           as SpecialFacFlag                        ,
              nvl(f.signedline, 0) as WrittenLine                           ,
              0                    as BaseShare                             ,
              DECODE(f.commrate                                             ,
                  null                                                      , 0,
                    f.commrate) as CommRate                                 ,
              DECODE(f.commrate                                             ,
                  null                                                      , 0,
                    f.commrate) * DECODE(f.repremium                        ,
                  null                                                      , 0,
                    f.repremium) / 100 as Commission                        ,
              0                        as SignedLine                        ,
              0                        as OutSignedLine                     ,
              f.facilitycode facility                                       ,
              '' as FacilityCode                                            ,
              '非比例临分' facType                                               ,
              r.versionNo
            from
              reinsvalidenquiryregisterxreins f,
              reinsvalidenquiryregister r
            where
              r.sequenceno  = f.sequenceno
            and r.versionNo = f.versionNo) c
        on
          a.sequenceno  = c.sequenceno
        and a.versionno = c.versionNo
        where
          1 = 1
        and not exists
          (
            select
              1
            from
              reinsenquiryregisterbinding f
            where
              a.sequenceno  = f.sequenceno
            and a.versionNo = f.bindVersionNo)
        and a.branchcode in
          (
            select
              comCode
            from
              FDCOMPANY
            where
              comPath like '%11000000%')) aa
    where
      1 = 1
    order by
      aa.sequenceno asc                                 ,
      cast(regexp_substr(aa.versionNo, '[0-9]+') as int),
      aa.certifyno desc                                 ,
      aa.facType                                        ,
      aa.layerno asc
  tidb_sql: >
    SELECT aa.*
    	, (
    		SELECT min(s.createdate)
    		FROM ReinsValidEnquiryRegister s
    		WHERE aa.sequenceno = s.sequenceno
    		GROUP BY s.sequenceno
    	) AS createDate
    	, (
    		SELECT CONCAT(CONCAT(CONCAT(CONCAT(CONCAT(CONCAT(max(CASE bb.businessStatus
    				WHEN '1' THEN bb.businessStatusname
    				ELSE NULL
    			END), max(CASE bb.businessStatus
    				WHEN '2' THEN CONCAT('->', bb.businessStatusname)
    				ELSE NULL
    			END)), max(CASE bb.businessStatus
    				WHEN '3' THEN CONCAT('->', bb.businessStatusname)
    				ELSE NULL
    			END)), max(CASE bb.businessStatus
    				WHEN '4' THEN CONCAT('->', bb.businessStatusname)
    				ELSE NULL
    			END)), max(CASE bb.businessStatus
    				WHEN '5' THEN CONCAT('->', bb.businessStatusname)
    				ELSE NULL
    			END)), max(CASE bb.businessStatus
    				WHEN '6' THEN CONCAT('->', bb.businessStatusname)
    				ELSE NULL
    			END)), max(CASE bb.businessStatus
    				WHEN '7' THEN CONCAT('->', bb.businessStatusname)
    				ELSE NULL
    			END)) AS workflow
    		FROM Reinsvalidenquiryregisterverify bb
    		WHERE bb.sequenceNo = aa.sequenceNo
    		GROUP BY bb.sequenceNo
    	) AS workflow
    FROM (
    	SELECT STR_TO_DATE(DATE_FORMAT(a.closedate, '%Y-%m-%d'), '%Y-%m-%d') AS closedate
    		, CASE c.riskunitcode
    			WHEN '0' THEN '整单'
    			ELSE c.riskunitcode
    		END AS riskUnitCode
    		, c.layerNo
    		, CASE c.riskunitcode
    			WHEN '0' THEN (
    					SELECT sum(ss.sharerate) / count(DISTINCT ss.riskunitcode)
    					FROM reinsshare ss
    					WHERE ss.reinsmode IN ('181', '182')
    						AND ss.validflag = '1'
    						AND ss.drecertifyno = c.certifyNo
    				)
    			ELSE (
    				SELECT sum(ss.sharerate)
    				FROM reinsshare ss
    				WHERE ss.reinsmode IN ('181', '182')
    					AND ss.validflag = '1'
    					AND ss.drecertifyno = c.certifyNo
    					AND ss.riskunitcode = c.riskunitcode
    			)
    		END AS retRate
    		, 100 AS retAllRate
    		, CASE c.sumfacshare
    			WHEN NULL THEN 0
    			ELSE c.sumfacshare
    		END AS signedLineOwn
    		, STR_TO_DATE(DATE_FORMAT(c.facConfirmDate, '%Y-%m-%d'), '%Y-%m-%d') AS facConfirmDate
    		, CASE l.locationflag
    			WHEN 'D' THEN '否'
    			WHEN 'F' THEN '是'
    			ELSE NULL
    		END AS withHoldFlag
    		, b.recertifyno AS recertifyNo, c.cutthroughflag AS cutthroughflag, a.sequenceno AS SequenceNo
    		, CASE c.signdate
    			WHEN NULL THEN '已录单'
    			ELSE '归档完毕'
    		END AS BusinessStatus
    		, CASE a.isBranch
    			WHEN '1' THEN '是'
    			ELSE '否'
    		END AS isBranch
    		, a.businessstatusdesc AS BusinessStatusDesc, fd.categoryname AS ClassCode, fd.riskCName AS riskName, a.branchName, a.reportno AS ReportNo
    		, a.branchoperatorname AS BranchOperatorName, a.operatorname AS OperatorName, a.itemname AS ItemName, a.riskclassname AS RiskClassName, a.faccodename AS FacCodeName
    		, CASE c.currency
    			WHEN NULL THEN NULL
    			ELSE c.currency
    		END AS Currency
    		, CASE c.gbbaseshare
    			WHEN NULL THEN 0
    			ELSE c.gbbaseshare
    		END AS CoinsRate
    		, c.ReinsCode
    		, (
    			SELECT fdr.longname
    			FROM fdreins fdr
    			WHERE fdr.reinscode = c.reinscode
    		) AS ReinsName, c.Freinscode
    		, (
    			SELECT fdr.longname
    			FROM fdreins fdr
    			WHERE fdr.reinscode = c.freinscode
    		) AS FreinsName, c.accreinscode AS accreinscode
    		, (
    			SELECT fdr.longname
    			FROM fdreins fdr
    			WHERE fdr.reinscode = c.accreinscode
    		) AS accReinsName, c.brokerCode
    		, (
    			SELECT fdr.longname
    			FROM fdreins fdr
    			WHERE fdr.reinscode = c.brokerCode
    		) AS brokerName, c.DiffFlag, c.certifyno AS CertifyNo
    		, CASE c.endorno
    			WHEN NULL THEN 'P'
    			ELSE 'E'
    		END AS certiType
    		, a.CloseCodeName AS CloseCode, NULL AS EnquiryInputDate, NULL AS AccInputDate, NULL AS AccPaymentCode, NULL AS AccPaymentDate
    		, NULL AS TelNo, c.AccRemarks, c.FacSlipFlag, c.FacSlipDate, c.facType
    		, CASE b.amount
    			WHEN NULL THEN 0
    			ELSE b.amount
    		END AS Amount
    		, CASE b.premium
    			WHEN NULL THEN 0
    			ELSE b.premium
    		END AS Premium
    		, CASE b.notaxpremium
    			WHEN NULL THEN 0
    			ELSE b.notaxpremium
    		END AS notaxpremium
    		, CASE b.baseamount
    			WHEN NULL THEN 0
    			ELSE b.baseamount
    		END AS BaseAmount
    		, CASE b.basepremium
    			WHEN NULL THEN 0
    			ELSE b.basepremium
    		END AS BasePremium
    		, CASE b.notaxbasepremium
    			WHEN NULL THEN 0
    			ELSE b.notaxbasepremium
    		END AS notaxbasepremium
    		, CASE c.sumfacshare
    			WHEN NULL THEN 0
    			ELSE c.sumfacshare
    		END AS OutSignedLine
    		, CASE c.outAmount
    			WHEN NULL THEN 0
    			ELSE c.outAmount
    		END AS outAmount
    		, CASE c.outPremium
    			WHEN NULL THEN 0
    			ELSE c.outPremium
    		END AS outPremium
    		, CASE c.noTaxoutPremium
    			WHEN NULL THEN 0
    			ELSE c.noTaxoutPremium
    		END AS noTaxoutPremium
    		, d.amount AS RetenAmount, d.premium AS RetenPremium, a.claimcondition AS ClaimCondition
    		, CASE a.offeredLine
    			WHEN NULL THEN 0
    			ELSE a.offeredLine
    		END AS OfferedLine
    		, CASE c.sumfacshare * c.gbbaseshare / 100
    			WHEN NULL THEN 0
    			ELSE c.sumfacshare * c.gbbaseshare / 100
    		END AS SignedLine
    		, c.SpecialFacFlag
    		, CASE c.WrittenLine
    			WHEN NULL THEN 0
    			ELSE c.WrittenLine
    		END AS WrittenLine
    		, CASE c.BaseShare
    			WHEN NULL THEN 0
    			ELSE c.BaseShare
    		END AS BaseShare
    		, CASE c.CommRate
    			WHEN NULL THEN 0
    			ELSE c.CommRate
    		END AS CommRate
    		, 0 AS OutSumPremium, 0 AS Commission, 0 AS TaxFee, 0 AS AddTaxFee, 0 AS OtherFee
    		, 0 AS Balance, DATE_FORMAT(c.startdate, '%Y-%m-%d') AS StartDate
    		, DATE_FORMAT(c.enddate, '%Y-%m-%d') AS EndDate, NULL AS ExecutiveRemark
    		, a.remarks AS Remarks, c.FacilityCode AS FacilityCode, a.firstdate AS FirstDate, a.noTaskReason AS noTaskReason, a.takeDate AS takeDate
    		, a.afterDate AS AfterDate, a.taskEndDate AS taskEndDate, c.verifyDate AS verifyDate, c.underWriteEndDate AS underWriteEndDate, c.underWriteEndDate AS operateDate
    		, CASE a.BusinessStatus
    			WHEN '1' THEN CONCAT(b.bindVersionNo, '(排分中)')
    			ELSE CONCAT(b.bindVersionNo, '(排分中已获得承保能力)')
    		END AS versionNo
    		, a.validStatus
    	FROM Reinsenquiryregisterbinding b
    	JOIN (
    		SELECT r.sequenceno, r.ClassCode, r.riskcode, r.comcode, e.signdate
    			, NULL AS layerNo, r.verifydate AS facConfirmDate, e.enquiryno, e.endorno, r.sumamount AS sumamount
    			, r.sumpremium AS sumpremium, r.baseshare AS gbbaseshare, r.specialfacshare AS specialfacshare, r.facshare AS facshare, r.sumfacshare AS sumfacshare
    			, CASE r.enquirytype
    				WHEN 'P' THEN r.policyno
    				WHEN 'E' THEN r.endorno
    				ELSE r.endorno
    			END AS certifyno
    			, r.riskunitcode AS riskunitcode, r.currency AS currency, e.reinscode AS reinscode, e.accreinscode AS accreinscode, e.accReinsName AS accReinsName
    			, e.reinsname AS ReinsName, e.finalreinscode AS Freinscode, e.finalreinsname AS FreinsName, e.brokercode AS brokercode, e.brokerName AS brokerName
    			, e.DiffFlag AS DiffFlag, NULL AS AccRemarks
    			, CASE e.signDate
    				WHEN NULL THEN '否'
    				ELSE '是'
    			END AS FacSlipFlag
    			, DATE_FORMAT(e.signDate, 'yyyy-mm') AS FacSlipDate
    			, CASE r.enquirytype
    				WHEN 'P' THEN e.amount
    				WHEN 'E' THEN e.chgamount
    				ELSE 0
    			END AS outAmount
    			, CASE r.enquirytype
    				WHEN 'P' THEN e.premium
    				WHEN 'E' THEN e.chgpremium
    				ELSE 0
    			END AS outPremium
    			, CASE r.enquirytype
    				WHEN 'P' THEN e.notaxpremium
    				WHEN 'E' THEN e.chgnotaxpremium
    				ELSE 0
    			END AS notaxOutPremium
    			, e.vatfee AS taxfee
    			, CASE e.facflag
    				WHEN '1' THEN '是'
    				ELSE '否'
    			END AS SpecialFacFlag
    			, IFNULL(e.signedline, 0) * IFNULL(r.BaseShare, 0) / 100 AS WrittenLine
    			, IFNULL(e.signedline, 0) AS BaseShare, e.signedcomm AS CommRate
    			, e.premium * e.signedcomm / 100 AS Commission, NULL AS FacilityCode
    			, '比例临分' AS facType, r.startdate, r.enddate, e.cutthroughflag AS cutthroughflag
    			, CASE r.verifyFlag
    				WHEN 3 THEN verifyDate
    				ELSE NULL
    			END AS verifyDate
    			, CASE r.enquiryType
    				WHEN 'P' THEN pUnit.underWriteEndDate
    				WHEN 'E' THEN eUnit.underWriteEndDate
    				ELSE NULL
    			END AS underWriteEndDate
    			, (
    				SELECT CASE 
    						WHEN count(1) = 0 THEN NOW()
    						ELSE max(writtenDate)
    					END AS writtenDate
    				FROM fzacc acc
    				WHERE ((r.policyNo = acc.drcertifyNo
    							AND r.enquiryType = 'P')
    						OR (r.endorNo = acc.drcertifyNo
    							AND r.enquiryType = 'E'))
    					AND e.accReinsCode = acc.accReinsCode
    					AND e.withHoldFlag = acc.withHoldFlag
    			) AS writtenDate
    		FROM ReinsEndorUnit eUnit
    		RIGHT JOIN ReinsValidEnquiry r ON r.endorNo = eUnit.endorNo 
    		LEFT JOIN ReinsPolicyUnit pUnit ON r.policyNo = pUnit.policyNo 
    			JOIN ReinsValidReceive e ON r.enquiryno = e.enquiryno
    			AND r.versionno = e.versionno 
    		WHERE e.versiondesc <> ' '
    			AND r.sequenceNo <> ' '
    			AND r.validflag = '1'
    		UNION ALL
    		SELECT r.sequenceno, r.ClassCode, r.riskcode, r.comcode, f.signdate
    			, f.layerno AS layerNo, r.verifydate AS facConfirmDate, f.enquiryno, r.endorno, r.sumamount AS sumamount
    			, r.sumpremium AS sumpremium, r.baseshare AS gbbaseshare, r.specialfacshare AS specialfacshare, r.facshare AS facshare, 0 AS sumfacshare
    			, CASE r.enquirytype
    				WHEN 'P' THEN r.policyno
    				WHEN 'E' THEN r.endorno
    				ELSE r.endorno
    			END AS certifyno
    			, r.riskunitcode AS riskunitcode, r.currency AS currency, f.reinscode AS Reinscode, f.accreinscode AS accreinscode, f.accReinsName AS accReinsName
    			, f.reinsname AS ReinsName, f.freinscode AS Freinscode, f.freinsname AS FreinsName, f.brokercode AS brokercode, f.brokerName AS brokerName
    			, CASE f.DiffFlag
    				WHEN '1' THEN '费率差异'
    				ELSE '无差异'
    			END AS DiffFlag
    			, NULL AS AccRemarks, NULL AS FacSlipFlag, NULL AS FacSlipDate, 0 AS outAmount
    			, CASE r.enquirytype
    				WHEN 'P' THEN f.premium
    				WHEN 'E' THEN f.chgpreium
    				ELSE 0
    			END AS outPremium
    			, CASE r.enquirytype
    				WHEN 'P' THEN f.notaxpremium
    				WHEN 'E' THEN f.CHGEXTAXPREMIUM
    				ELSE 0
    			END AS notaxoutPremium
    			, f.vat AS taxfee
    			, CASE f.facflag
    				WHEN '1' THEN '是'
    				ELSE '否'
    			END AS SpecialFacFlag
    			, IFNULL(f.sharerate, 0) AS WrittenLine
    			, IFNULL(f.sharerate, 0) AS BaseShare
    			, CASE f.COMMISSIONSRATE
    				WHEN NULL THEN 0
    				ELSE f.COMMISSIONSRATE
    			END AS CommRate
    			, f.premium * f.commissionsrate AS Commission, NULL AS FacilityCode, '非比例临分' AS facType
    			, r.startdate, r.enddate, '0' AS cutthroughflag
    			, CASE r.verifyFlag
    				WHEN 3 THEN verifyDate
    				ELSE NULL
    			END AS verifyDate
    			, CASE r.enquiryType
    				WHEN 'P' THEN pUnit.underWriteEndDate
    				WHEN 'E' THEN eUnit.underWriteEndDate
    				ELSE NULL
    			END AS underWriteEndDate
    			, (
    				SELECT CASE 
    						WHEN count(1) = 0 THEN NOW()
    						ELSE max(writtenDate)
    					END AS writtenDate
    				FROM fzacc acc
    				WHERE ((r.policyNo = acc.drcertifyNo
    							AND r.enquiryType = 'P')
    						OR (r.endorNo = acc.drcertifyNo
    							AND r.enquiryType = 'E'))
    					AND f.accReinsCode = acc.accReinsCode
    					AND f.withHoldFlag = acc.withHoldFlag
    					AND f.layerno = acc.sectionNo
    			) AS writtenDate
    		FROM ReinsEndorUnit eUnit
    		RIGHT JOIN ReinsValidEnquiry r ON r.endorNo = eUnit.endorNo 
    		LEFT JOIN ReinsPolicyUnit pUnit ON r.policyNo = pUnit.policyNo 
    			JOIN REINSVALIDXOLRECEIVE f ON r.enquiryno = f.enquiryno
    			AND r.versionno = f.versionno 
    		WHERE f.versiondesc <> ' '
    			AND r.sequenceNo <> ' '
    			AND r.validflag = '1'
    	) c ON c.certifyno = b.certifyno
    		AND c.riskunitcode = b.riskunitcode 
    	JOIN ReinsValidEnquiryRegister a ON a.sequenceNo = b.sequenceNo
    		AND a.versionno = b.versionno
    		AND a.sequenceNo = c.sequenceNo 
    	JOIN fdCompany company ON company.comcode = a.branchcode 
    	JOIN ReinsValidEnquiryRegisterVerify Verify ON a.sequenceNo = verify.sequenceNo
    		AND a.versionno = verify.versionno 
    	JOIN fdReins l ON l.reinscode = c.freinscode 
    	JOIN fdrisk fd ON fd.riskcode = c.riskcode 
    		LEFT JOIN (
    			SELECT drcertifyno, riskunitcode, sum(amount) AS amount
    				, sum(premium) AS premium
    			FROM reinsretenshare
    			GROUP BY drcertifyno, riskunitcode
    			UNION ALL
    			SELECT drcertifyno, '0', sum(amount) AS amount
    				, sum(premium) AS premium
    			FROM reinsretenshare
    			GROUP BY drcertifyno
    		) d ON c.certifyno = d.DRCERTIFYNO
    		AND c.riskunitcode = d.RISKUNITCODE 
    	WHERE fd.validStatus = '1'
    		AND a.validflag = '1'
    	UNION ALL
    	SELECT a.closedate AS closedate, NULL AS riskUnitCode, c.layerNo
    		, CASE c.facType
    			WHEN '比例临分' THEN a.retenShare / a.coinsRate * 100
    			ELSE 0
    		END AS retRate
    		, IFNULL(a.retenShare, 0) AS retAllRate
    		, CASE a.signedLine
    			WHEN NULL THEN 0
    			ELSE a.signedLine / a.coinsRate * 100
    		END AS signedLineOwn
    		, NULL AS facConfirmDate
    		, CASE (
    				SELECT DISTINCT l.locationflag
    				FROM fdReins l
    				WHERE l.reinscode = c.freinscode
    			)
    			WHEN 'D' THEN '否'
    			WHEN 'F' THEN '是'
    			ELSE NULL
    		END AS withHoldFlag
    		, NULL AS recertifyNo, NULL AS cutthroughflag, a.sequenceno AS SequenceNo, a.businessstatusName AS BusinessStatus
    		, CASE a.isBranch
    			WHEN '1' THEN '是'
    			ELSE '否'
    		END AS isBranch
    		, a.businessstatusdesc AS BusinessStatusDesc, a.classname AS classCode, NULL AS riskName, a.branchname AS branchName, a.reportno AS ReportNo
    		, a.branchoperatorname AS BranchOperatorName, a.operatorname AS OperatorName, a.itemname AS ItemName, a.riskclassname AS RiskClassName, a.faccodename AS FacCodeName
    		, CASE a.currency
    			WHEN NULL THEN NULL
    			ELSE a.currency
    		END AS Currency
    		, CASE a.coinsrate
    			WHEN NULL THEN 0
    			ELSE a.coinsrate
    		END AS CoinsRate
    		, c.ReinsCode, c.ReinsName, c.Freinscode, c.FreinsName, c.accreinscode AS accreinscode
    		, c.accReinsName, c.brokerCode, c.brokerName, c.DiffFlag, NULL AS CertifyNo
    		, NULL AS certiType, a.CloseCodeName AS CloseCode, NULL AS EnquiryInputDate, NULL AS AccInputDate, NULL AS AccPaymentCode
    		, NULL AS AccPaymentDate, c.telno AS telNo, c.AccRemarks, c.FacSlipFlag, c.FacSlipDate
    		, c.facType
    		, CASE a.amount
    			WHEN NULL THEN 0
    			ELSE a.amount
    		END AS Amount
    		, CASE a.premium
    			WHEN NULL THEN 0
    			ELSE a.premium
    		END AS Premium
    		, CASE a.notaxpremium
    			WHEN NULL THEN 0
    			ELSE a.notaxpremium
    		END AS notaxpremium
    		, CASE a.baseamount
    			WHEN NULL THEN 0
    			ELSE a.baseamount
    		END AS BaseAmount
    		, CASE a.basepremium
    			WHEN NULL THEN 0
    			ELSE a.basepremium
    		END AS BasePremium
    		, CASE a.notaxbasepremium
    			WHEN NULL THEN 0
    			ELSE a.notaxbasepremium
    		END AS notaxbasepremium
    		, CASE c.OutSignedLine
    			WHEN NULL THEN 0
    			ELSE c.OutSignedLine
    		END AS OutSignedLine
    		, CASE c.outAmount
    			WHEN NULL THEN 0
    			ELSE c.outAmount
    		END AS outAmount
    		, CASE c.outPremium
    			WHEN NULL THEN 0
    			ELSE c.outPremium
    		END AS outPremium
    		, CASE c.noTaxoutPremium
    			WHEN NULL THEN 0
    			ELSE c.noTaxoutPremium
    		END AS noTaxoutPremium
    		, CASE a.retenamount
    			WHEN NULL THEN 0
    			ELSE a.retenamount
    		END AS RetenAmount
    		, CASE a.retenpremium
    			WHEN NULL THEN 0
    			ELSE a.retenpremium
    		END AS RetenPremium
    		, a.claimcondition AS ClaimCondition
    		, CASE a.offeredline
    			WHEN NULL THEN 0
    			ELSE a.offeredline
    		END AS OfferedLine
    		, CASE c.SignedLine
    			WHEN NULL THEN 0
    			ELSE c.SignedLine
    		END AS SignedLine
    		, c.SpecialFacFlag
    		, CASE c.WrittenLine
    			WHEN NULL THEN 0
    			ELSE c.WrittenLine
    		END AS WrittenLine
    		, CASE c.BaseShare
    			WHEN NULL THEN 0
    			ELSE c.BaseShare
    		END AS BaseShare
    		, CASE c.CommRate
    			WHEN NULL THEN 0
    			ELSE c.CommRate
    		END AS CommRate
    		, CASE c.noTaxoutPremium
    			WHEN NULL THEN 0
    			ELSE c.noTaxoutPremium
    		END AS OutSumPremium
    		, CASE c.Commission
    			WHEN NULL THEN 0
    			ELSE c.Commission
    		END AS Commission
    		, 0 AS TaxFee, 0 AS AddTaxFee, 0 AS OtherFee, 0 AS Balance
    		, DATE_FORMAT(a.startdate, '%Y-%m-%d') AS StartDate
    		, DATE_FORMAT(a.enddate, '%Y-%m-%d') AS EndDate, NULL AS ExecutiveRemark
    		, a.remarks AS Remarks, c.FacilityCode AS FacilityCode, a.firstdate AS FirstDate, a.noTaskReason AS noTaskReason, a.takeDate AS takeDate
    		, NULL AS AfterDate, a.taskEndDate AS taskEndDate, NULL AS verifyDate, NULL AS underWriteEndDate, verify.operateDate
    		, CASE a.BusinessStatus
    			WHEN '1' THEN CONCAT(a.versionno, '（排分中)')
    			ELSE CONCAT(a.versionNo, '(排分中已获得承保能力)')
    		END AS versionNo
    		, a.validStatus
    	FROM ReinsValidEnquiryRegister a
    	JOIN (
    		SELECT NULL AS layerNo, r.telno, e.sequenceno, r.reinscode AS reinscode, r.reinsname AS ReinsName
    			, r.freinscode AS Freinscode, r.freinsname AS FreinsName, r.accreinscode AS accreinscode, r.accReinsName, r.brokerCode
    			, r.brokerName, r.DiffFlag AS DiffFlag, r.accremarks AS AccRemarks
    			, CASE r.facslipflag
    				WHEN 1 THEN '是'
    				ELSE '否'
    			END AS FacSlipFlag
    			, DATE_FORMAT(r.facslipdate, 'yyyy-mm') AS FacSlipDate, r.amount AS outAmount
    			, r.premium AS outPremium, r.notaxpremium AS notaxoutPremium
    			, CASE r.specialfacflag
    				WHEN '1' THEN '是'
    				ELSE '否'
    			END AS SpecialFacFlag
    			, r.WRITTENLINE AS WrittenLine, IFNULL(r.BaseShare, 0) AS BaseShare
    			, CASE r.commrate
    				WHEN NULL THEN 0
    				ELSE r.commrate
    			END AS CommRate
    			, CASE r.commRate
    				WHEN NULL THEN 0
    				ELSE r.commRate
    			END * CASE r.premium
    				WHEN NULL THEN 0
    				ELSE r.premium
    			END / 100 AS Commission
    			, CASE e.signedline
    				WHEN NULL THEN 0
    				ELSE e.signedline
    			END AS SignedLine
    			, CASE round(e.signedline / e.coinsrate / 100, 6)
    				WHEN NULL THEN 0
    				ELSE round(e.signedline / e.coinsrate / 100, 6)
    			END AS OutSignedLine
    			, r.facilitycode AS facility, NULL AS FacilityCode, '比例临分' AS facType, e.versionNo
    		FROM reinsvalidenquiryregister e
    			JOIN reinsvalidenquiryregisterreins r ON r.sequenceno = e.sequenceno
    			AND e.versionno = r.versionno 
    		UNION ALL
    		SELECT f.layerNo AS layerNo, f.telno, r.sequenceno, f.reinscode AS Reinscode, f.reinsname AS ReinsName
    			, f.freinscode AS Freinscode, f.freinsname AS FreinsName, f.accreinscode AS accreinscode, f.accReinsName, f.brokerCode
    			, f.brokerName
    			, CASE f.diffflag
    				WHEN '1' THEN '费率差异'
    				ELSE '无差异'
    			END AS DiffFlag
    			, f.accremarks AS AccRemarks
    			, CASE f.facslipflag
    				WHEN 1 THEN '是'
    				ELSE '否'
    			END AS FacSlipFlag
    			, DATE_FORMAT(f.facslipdate, 'yyyy-mm') AS FacSlipDate, 0 AS outAmount
    			, f.repremium AS outPremium, f.noTaxrepremium AS noTaxoutPremium
    			, CASE f.specialfacflag
    				WHEN '1' THEN '是'
    				ELSE '否'
    			END AS SpecialFacFlag
    			, IFNULL(f.signedline, 0) AS WrittenLine, 0 AS BaseShare
    			, CASE f.commrate
    				WHEN NULL THEN 0
    				ELSE f.commrate
    			END AS CommRate
    			, CASE f.commrate
    				WHEN NULL THEN 0
    				ELSE f.commrate
    			END * CASE f.repremium
    				WHEN NULL THEN 0
    				ELSE f.repremium
    			END / 100 AS Commission
    			, 0 AS SignedLine, 0 AS OutSignedLine, f.facilitycode AS facility, NULL AS FacilityCode, '非比例临分' AS facType
    			, r.versionNo
    		FROM reinsvalidenquiryregisterxreins f
    			JOIN reinsvalidenquiryregister r ON r.sequenceno = f.sequenceno
    			AND r.versionNo = f.versionNo 
    	) c ON a.sequenceno = c.sequenceno
    		AND a.versionno = c.versionNo 
    		JOIN ReinsValidEnquiryRegisterVerify Verify ON a.sequenceno = Verify.sequenceno
    		AND a.versionno = Verify.versionNo 
    	WHERE 1 = 1
    ) aa
    WHERE 1 = 1
    ORDER BY aa.sequenceno ASC, CAST(regexp_substr(aa.versionNo, '[0-9]+') AS SIGNED INTEGER), aa.certifyno DESC, aa.facType, aa.layerno ASC


- comment: 分出临分登记信息导出 --- 我司部分
  oracle_sql: >
    select
      x.sequenceNo                              ,
      x.businessStatus                          ,
      x.businessStatusDesc                      ,
      x.className                               ,
      x.branchName                              ,
      x.reportNo                                ,
      x.branchOperatorName                      ,
      x.operatorName                            ,
      x.itemName                                ,
      x.isBranch                                ,
      x.riskClassName                           ,
      x.facCodeName                             ,
      x.currency                                ,
      x.coinsRate                               ,
      x.closeCodeName                           ,
      x.createDate                              ,
      x.closeDate                               ,
      sum(x.amount) amount                      ,
      sum(x.premiumBigDecimal) premiumBigDecimal,
      sum(x.noTaxPremium) noTaxPremium          ,
      sum(x.baseAmount) baseAmount              ,
      sum(x.noTaxBasePremium) noTaxBasePremium  ,
      sum(outSumPremium) outSumPremium          ,
      x.claimCondition                          ,
      x.startDateDate                           ,
      x.endDateDate                             ,
      x.firstDateLong                           ,
      x.afterDateLong                           ,
      x.takeDate                                ,
      x.facOfferedRate                          ,
      x.facAbilityRate                          ,
      x.baseFacAbilityRate                      ,
      x.baseFacOfferedRate                      ,
      x.remarks                                 ,
      x.validStatus                             ,
      x.currencyEnquiry
    from
      (
        select
          a.sequenceNo               ,
          a.businessStatus           ,
          a.businessStatusDesc       ,
          a.className                ,
          a.branchName               ,
          a.reportNo                 ,
          a.branchOperatorName       ,
          a.operatorName             ,
          a.itemName                 ,
          a.isBranch                 ,
          a.riskClassName            ,
          a.facCodeName              ,
          a.currency                 ,
          a.coinsRate / 100 coinsRate,
          a.closeCodeName            ,
          (
            select
              min(c.CREATEDATE)
            from
              REINSVALIDENQUIRYREGISTER c
            where
              c.SEQUENCENO  = a.SEQUENCENO
            and c.VERSIONNO = '1') createDate                                      ,
          a.closeDate                                                              ,
          nvl(sum(b.amount), nvl(a.AMOUNT, 0)) amount                              ,
          nvl(sum(b.premium), nvl(a.PREMIUM, 0)) premiumBigDecimal                 ,
          nvl(sum(b.noTaxPremium), nvl(a.NOTAXPREMIUM, 0)) noTaxPremium            ,
          nvl(sum(b.baseAmount), nvl(a.BASEAMOUNT, 0)) baseAmount                  ,
          nvl(sum(b.noTaxBasePremium), nvl(a.NOTAXBASEPREMIUM, 0)) noTaxBasePremium,
          a.claimCondition                                                         ,
          a.startDate startDateDate                                                ,
          a.endDate endDateDate                                                    ,
          a.firstDate firstDateLong                                                ,
          a.afterDate afterDateLong                                                ,
          a.takeDate                                                               ,
          (
            select
              nvl(sum(bb.offeredLine), 0) / 100
            from
              RI_FACREGISTERREINS bb
            where
              a.sequenceno = bb.sequenceno
            group by
              bb.sequenceno) facOfferedRate,
          (
            select
              nvl(sum(bb.writtenLine), 0) / 100
            from
              RI_FACREGISTERREINS bb
            where
              a.sequenceno = bb.sequenceno
            group by
              bb.sequenceno) facAbilityRate,
          (
          (
            select
              nvl(sum(dd.NOTAXPREMIUM), 0)
            from
              REINSVALIDRECEIVE dd
            where
              cc.versionNo      = dd.versionNo
            and cc.ENQUIRYNO    = dd.ENQUIRYNO
            and dd.RISKUNITCODE != '0'
            and cc.ENQUIRYTYPE  = 'P') +
          (
            select
              nvl(sum(dd.CHGNOTAXPREMIUM), 0)
            from
              REINSVALIDRECEIVE dd
            where
              cc.versionNo      = dd.versionNo
            and cc.ENQUIRYNO    = dd.ENQUIRYNO
            and dd.RISKUNITCODE != '0'
            and cc.ENQUIRYTYPE  = 'E'
            and (
                exists
                (
                  select
                    1
                  from
                    REINSVALIDENQUIRY ee
                  where
                    ee.POLICYNO      = dd.POLICYNO
                  and ee.ENQUIRYTYPE = 'P')))) outSumPremium,
          round(
          (
            select
              nvl(sum(bb.offeredLine), 0)
            from
              RI_FACREGISTERREINS bb
            where
              a.sequenceno = bb.sequenceno
            group by
              bb.sequenceno) / a.coinsRate, 6) baseFacOfferedRate,
          round(
          (
            select
              nvl(sum(bb.writtenLine), 0)
            from
              RI_FACREGISTERREINS bb
            where
              a.sequenceno = bb.sequenceno
            group by
              bb.sequenceno) / a.coinsRate, 6) baseFacAbilityRate,
          a.remarks                                              ,
          a.validStatus                                          ,
          cc.currency currencyEnquiry
        from
          REINSVALIDENQUIRYREGISTER a
        left join
          Reinsenquiryregisterbinding b
        on
          a.SEQUENCENO  = b.SEQUENCENO
        and b.VALIDFLAG = '1'
        left join
          REINSVALIDENQUIRY cc
        on
          a.sequenceno     = cc.sequenceno
        and cc.VALIDFLAG   = '1'
        and b.RISKUNITCODE = cc.RISKUNITCODE
        and decode(cc.ENQUIRYTYPE,
              'E'                , cc.ENDORNO,
                cc.POLICYNO) = b.CERTIFYNO
        where
          a.VALIDFLAG = '1'
        and (
            exists
            (
              select
                1
              from
                reinsvalidriskunit e
              where
                e.policyno in
                (
                  select
                    f.certifyno
                  from
                    reinsenquiryregisterbinding f
                  where
                    f.certitype    = 'P'
                  and b.SEQUENCENO = f.SEQUENCENO
                  and f.VALIDFLAG  = '1')
              and b.certifyno      = e.certifyno)
            or not exists
            (
              select
                1
              from
                reinsenquiryregisterbinding f
              where
                f.SEQUENCENO  = a.SEQUENCENO
              and f.VALIDFLAG = '1'))
        And (
            a.sequenceNo IN ('FO01012018000001',
                            'FO01012018000003' ,
                            'FO01012018000004' ,
                            'FOnull2020000000'))
        and a.branchcode in
          (
            select
              comCode
            from
              FDCOMPANY
            where
              comPath like '%11000000%')
        group by
          a.sequenceNo        ,
          a.businessStatus    ,
          a.businessStatusDesc,
          a.className         ,
          a.branchName        ,
          a.reportNo          ,
          a.branchOperatorName,
          a.operatorName      ,
          a.itemName          ,
          a.isBranch          ,
          a.riskClassName     ,
          a.facCodeName       ,
          a.currency          ,
          a.coinsRate         ,
          a.closeCodeName     ,
          a.closeDate         ,
          a.claimCondition    ,
          a.startDate         ,
          a.endDate           ,
          a.firstDate         ,
          a.afterDate         ,
          a.takeDate          ,
          a.remarks           ,
          a.versionNo         ,
          a.validStatus       ,
          cc.CURRENCY         ,
          cc.versionNo        ,
          cc.ENQUIRYNO        ,
          cc.ENQUIRYTYPE      ,
          a.AMOUNT            ,
          a.PREMIUM           ,
          a.NOTAXPREMIUM      ,
          a.BASEAMOUNT        ,
          a.NOTAXBASEPREMIUM) x
    group by
      x.sequenceNo        ,
      x.businessStatus    ,
      x.businessStatusDesc,
      x.className         ,
      x.branchName        ,
      x.reportNo          ,
      x.branchOperatorName,
      x.operatorName      ,
      x.itemName          ,
      x.isBranch          ,
      x.riskClassName     ,
      x.facCodeName       ,
      x.currency          ,
      x.coinsRate         ,
      x.closeCodeName     ,
      x.createDate        ,
      x.closeDate         ,
      x.claimCondition    ,
      x.startDateDate     ,
      x.endDateDate       ,
      x.firstDateLong     ,
      x.afterDateLong     ,
      x.takeDate          ,
      x.facOfferedRate    ,
      x.facAbilityRate    ,
      x.baseFacAbilityRate,
      x.baseFacOfferedRate,
      x.remarks           ,
      x.validStatus       ,
      x.currencyEnquiry
  tidb_sql: >
    SELECT x.sequenceNo, x.businessStatus, x.businessStatusDesc, x.className, x.branchName
    	, x.reportNo, x.branchOperatorName, x.operatorName, x.itemName, x.isBranch
    	, x.riskClassName, x.facCodeName, x.currency, x.coinsRate, x.closeCodeName
    	, x.createDate, x.closeDate, sum(x.amount) AS amount
    	, sum(x.premiumBigDecimal) AS premiumBigDecimal, sum(x.noTaxPremium) AS noTaxPremium
    	, sum(x.baseAmount) AS baseAmount, sum(x.noTaxBasePremium) AS noTaxBasePremium
    	, sum(outSumPremium) AS outSumPremium, x.claimCondition, x.startDateDate
    	, x.endDateDate, x.firstDateLong, x.afterDateLong, x.takeDate, x.facOfferedRate
    	, x.facAbilityRate, x.baseFacAbilityRate, x.baseFacOfferedRate, x.remarks, x.validStatus
    	, x.currencyEnquiry
    FROM (
    	SELECT a.sequenceNo, a.businessStatus, a.businessStatusDesc, a.className, a.branchName
    		, a.reportNo, a.branchOperatorName, a.operatorName, a.itemName, a.isBranch
    		, a.riskClassName, a.facCodeName, a.currency, a.coinsRate / 100 AS coinsRate
    		, a.closeCodeName
    		, (
    			SELECT min(c.CREATEDATE)
    			FROM REINSVALIDENQUIRYREGISTER c
    			WHERE c.SEQUENCENO = a.SEQUENCENO
    				AND c.VERSIONNO = '1'
    		) AS createDate, a.closeDate
    		, IFNULL(sum(b.amount), IFNULL(a.AMOUNT, 0)) AS amount
    		, IFNULL(sum(b.premium), IFNULL(a.PREMIUM, 0)) AS premiumBigDecimal
    		, IFNULL(sum(b.noTaxPremium), IFNULL(a.NOTAXPREMIUM, 0)) AS noTaxPremium
    		, IFNULL(sum(b.baseAmount), IFNULL(a.BASEAMOUNT, 0)) AS baseAmount
    		, IFNULL(sum(b.noTaxBasePremium), IFNULL(a.NOTAXBASEPREMIUM, 0)) AS noTaxBasePremium
    		, a.claimCondition, a.startDate AS startDateDate, a.endDate AS endDateDate, a.firstDate AS firstDateLong, a.afterDate AS afterDateLong
    		, a.takeDate
    		, (
    			SELECT IFNULL(sum(bb.offeredLine), 0) / 100
    			FROM RI_FACREGISTERREINS bb
    			WHERE a.sequenceno = bb.sequenceno
    			GROUP BY bb.sequenceno
    		) AS facOfferedRate
    		, (
    			SELECT IFNULL(sum(bb.writtenLine), 0) / 100
    			FROM RI_FACREGISTERREINS bb
    			WHERE a.sequenceno = bb.sequenceno
    			GROUP BY bb.sequenceno
    		) AS facAbilityRate, (
    			SELECT IFNULL(sum(dd.NOTAXPREMIUM), 0)
    			FROM REINSVALIDRECEIVE dd
    			WHERE cc.versionNo = dd.versionNo
    				AND cc.ENQUIRYNO = dd.ENQUIRYNO
    				AND dd.RISKUNITCODE != '0'
    				AND cc.ENQUIRYTYPE = 'P'
    		) + (
    			SELECT IFNULL(sum(dd.CHGNOTAXPREMIUM), 0)
    			FROM REINSVALIDRECEIVE dd
    			WHERE cc.versionNo = dd.versionNo
    				AND cc.ENQUIRYNO = dd.ENQUIRYNO
    				AND dd.RISKUNITCODE != '0'
    				AND cc.ENQUIRYTYPE = 'E'
    				AND EXISTS (
    					SELECT 1
    					FROM REINSVALIDENQUIRY ee
    					WHERE ee.POLICYNO = dd.POLICYNO
    						AND ee.ENQUIRYTYPE = 'P'
    				)
    		) AS outSumPremium
    		, round((
    			SELECT IFNULL(sum(bb.offeredLine), 0)
    			FROM RI_FACREGISTERREINS bb
    			WHERE a.sequenceno = bb.sequenceno
    			GROUP BY bb.sequenceno
    		) / a.coinsRate, 6) AS baseFacOfferedRate
    		, round((
    			SELECT IFNULL(sum(bb.writtenLine), 0)
    			FROM RI_FACREGISTERREINS bb
    			WHERE a.sequenceno = bb.sequenceno
    			GROUP BY bb.sequenceno
    		) / a.coinsRate, 6) AS baseFacAbilityRate
    		, a.remarks, a.validStatus, cc.currency AS currencyEnquiry
    	FROM Reinsenquiryregisterbinding b
    	JOIN REINSVALIDENQUIRY cc ON b.RISKUNITCODE = cc.RISKUNITCODE
    		JOIN REINSVALIDENQUIRYREGISTER a ON a.SEQUENCENO = b.SEQUENCENO
    		AND a.sequenceno = cc.sequenceno
    	WHERE b.VALIDFLAG = '1'
    		AND cc.VALIDFLAG = '1'
    		AND a.VALIDFLAG = '1'
    	GROUP BY a.sequenceNo, a.businessStatus, a.businessStatusDesc, a.className, a.branchName, a.reportNo, a.branchOperatorName, a.operatorName, a.itemName, a.isBranch, a.riskClassName, a.facCodeName, a.currency, a.coinsRate, a.closeCodeName, a.closeDate, a.claimCondition, a.startDate, a.endDate, a.firstDate, a.afterDate, a.takeDate, a.remarks, a.versionNo, a.validStatus, cc.CURRENCY, cc.versionNo, cc.ENQUIRYNO, cc.ENQUIRYTYPE, a.AMOUNT, a.PREMIUM, a.NOTAXPREMIUM, a.BASEAMOUNT, a.NOTAXBASEPREMIUM
    ) x
    GROUP BY x.sequenceNo, x.businessStatus, x.businessStatusDesc, x.className, x.branchName, x.reportNo, x.branchOperatorName, x.operatorName, x.itemName, x.isBranch, x.riskClassName, x.facCodeName, x.currency, x.coinsRate, x.closeCodeName, x.createDate, x.closeDate, x.claimCondition, x.startDateDate, x.endDateDate, x.firstDateLong, x.afterDateLong, x.takeDate, x.facOfferedRate, x.facAbilityRate, x.baseFacAbilityRate, x.baseFacOfferedRate, x.remarks, x.validStatus, x.currencyEnquiry